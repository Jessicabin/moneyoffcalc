import{l as L}from"./lodash-961725d3.js";import{e as z,r as G,m as w,w as at,a as it,i as N,b as U,t as W,d as lt,f as ut,g as K,o as dt,n as ft,h as pt,j as ht,E as J}from"./element-0bc65390.js";var gt=!1;/*!
  * pinia v2.0.23
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let Q;const E=e=>Q=e,X=Symbol();function v(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var k;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(k||(k={}));function vt(){const e=z(!0),o=e.run(()=>G({}));let t=[],s=[];const n=w({install(r){E(n),n._a=r,r.provide(X,n),r.config.globalProperties.$pinia=n,s.forEach(c=>t.push(c)),s=[]},use(r){return!this._a&&!gt?s.push(r):t.push(r),this},_p:t,_a:null,_e:e,_s:new Map,state:o});return n}const Z=()=>{};function V(e,o,t,s=Z){e.push(o);const n=()=>{const r=e.indexOf(o);r>-1&&(e.splice(r,1),s())};return!t&&K()&&dt(n),n}function P(e,...o){e.slice().forEach(t=>{t(...o)})}function F(e,o){e instanceof Map&&o instanceof Map&&o.forEach((t,s)=>e.set(s,t)),e instanceof Set&&o instanceof Set&&o.forEach(e.add,e);for(const t in o){if(!o.hasOwnProperty(t))continue;const s=o[t],n=e[t];v(n)&&v(s)&&e.hasOwnProperty(t)&&!N(s)&&!U(s)?e[t]=F(n,s):e[t]=s}return e}const yt=Symbol();function mt(e){return!v(e)||!e.hasOwnProperty(yt)}const{assign:O}=Object;function bt(e){return!!(N(e)&&e.effect)}function Ct(e,o,t,s){const{state:n,actions:r,getters:c}=o,l=t.state.value[e];let a;function i(){l||(t.state.value[e]=n?n():{});const d=pt(t.state.value[e]);return O(d,r,Object.keys(c||{}).reduce((h,b)=>(h[b]=w(ht(()=>{E(t);const T=t._s.get(e);return c[b].call(T,T)})),h),{}))}return a=tt(e,i,o,t,s,!0),a.$reset=function(){const h=n?n():{};this.$patch(b=>{O(b,h)})},a}function tt(e,o,t={},s,n,r){let c;const l=O({actions:{}},t),a={deep:!0};let i,d,h=w([]),b=w([]),T;const S=s.state.value[e];!r&&!S&&(s.state.value[e]={}),G({});let q;function A(p){let f;i=d=!1,typeof p=="function"?(p(s.state.value[e]),f={type:k.patchFunction,storeId:e,events:T}):(F(s.state.value[e],p),f={type:k.patchObject,payload:p,storeId:e,events:T});const C=q=Symbol();ft().then(()=>{q===C&&(i=!0)}),d=!0,P(h,f,s.state.value[e])}const et=Z;function ot(){c.stop(),h=[],b=[],s._s.delete(e)}function nt(p,f){return function(){E(s);const C=Array.from(arguments),I=[],_=[];function rt(g){I.push(g)}function ct(g){_.push(g)}P(b,{args:C,name:p,store:y,after:rt,onError:ct});let M;try{M=f.apply(this&&this.$id===e?this:y,C)}catch(g){throw P(_,g),g}return M instanceof Promise?M.then(g=>(P(I,g),g)).catch(g=>(P(_,g),Promise.reject(g))):(P(I,M),M)}}const st={_p:s,$id:e,$onAction:V.bind(null,b),$patch:A,$reset:et,$subscribe(p,f={}){const C=V(h,p,f.detached,()=>I()),I=c.run(()=>at(()=>s.state.value[e],_=>{(f.flush==="sync"?d:i)&&p({storeId:e,type:k.direct,events:T},_)},O({},a,f)));return C},$dispose:ot},y=it(st);s._s.set(e,y);const j=s._e.run(()=>(c=z(),c.run(()=>o())));for(const p in j){const f=j[p];if(N(f)&&!bt(f)||U(f))r||(S&&mt(f)&&(N(f)?f.value=S[p]:F(f,S[p])),s.state.value[e][p]=f);else if(typeof f=="function"){const C=nt(p,f);j[p]=C,l.actions[p]=f}}return O(y,j),O(W(y),j),Object.defineProperty(y,"$state",{get:()=>s.state.value[e],set:p=>{A(f=>{O(f,p)})}}),s._p.forEach(p=>{O(y,c.run(()=>p({store:y,app:s._a,pinia:s,options:l})))}),S&&r&&t.hydrate&&t.hydrate(y.$state,S),i=!0,d=!0,y}function Ot(e,o,t){let s,n;const r=typeof o=="function";typeof e=="string"?(s=e,n=r?t:o):(n=e,s=e.id);function c(l,a){const i=K();return l=l||i&&lt(X),l&&E(l),l=Q,l._s.has(s)||(r?tt(s,o,n,l):Ct(s,n,l)),l._s.get(s)}return c.$id=s,c}function Ft(e){{e=W(e);const o={};for(const t in e){const s=e[t];(N(s)||U(s))&&(o[t]=ut(e,t))}return o}}let Lt=e=>crypto.getRandomValues(new Uint8Array(e)),Tt=(e,o,t)=>{let s=(2<<Math.log(e.length-1)/Math.LN2)-1,n=-~(1.6*s*o/e.length);return(r=o)=>{let c="";for(;;){let l=t(n),a=n;for(;a--;)if(c+=e[l[a]&s]||"",c.length===r)return c}}},St=(e,o=21)=>Tt(e,o,Lt);const H=()=>St("1234567890abcdefghijklmnopqrstuvwxyz",8)(8),R=(e,o,t="")=>{const s=new Blob([e],{type:`application/${o}`});if(t=`${t}.${o}`,window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(s,t);else{const n=document.createElement("a"),r=document.querySelector("body");n.href=window.URL.createObjectURL(s),n.download=t,n.style.display="none",r.appendChild(n),n.click(),r.removeChild(n),window.URL.revokeObjectURL(n.href)}},m=({array:e=[],map:o={},key:t="id",value:s="item"})=>(e.forEach(n=>{const r=t?n[t]:n,c=s==="item"?n:n[s];o[r]=c}),o),Pt=e=>typeof e=="string",jt=e=>Object.prototype.toString.call(e)==="[object Object]",It=e=>Object.prototype.toString.call(e)==="[object Array]",_t=e=>e==null||Pt(e)&&e===""||It(e)&&e.length===0||jt(e)&&Object.keys(e).length===0,Ut=e=>new Promise(o=>{const t=new FileReader;t.readAsText(e),t.onload=s=>{const n=JSON.parse(s.target.result);o(n)}}),u=e=>Math.round(e*100)/100,Mt=()=>"#"+Math.floor(Math.random()*16777215).toString(16);class B{constructor(o={}){var t;Object.assign(this,o),this.map=(t=this.map)!=null?t:{},this.options=this.getOptions()}getOptions(){const o=[];if(Object.keys(this.map).length)for(let t in this.map){/^[0-9]*$/.test(t)&&(t=+t);let s={label:this.map[t],value:t};o.push(s)}return o}}class x{constructor({productList:o=[],calcCon:t={},moneyOffConfig:s,categoryCouponConfig:n}){Object.assign(this,{productList:o,calcCon:t,categoryCouponConfig:n}),this.moneyOffSlnConfig=s[t.moneyOff.id],this.cateCouponLength=Object.keys(this.categoryCouponConfig).length,this.productMap=m({array:this.productList,key:"id",value:"item"})}calc(){console.time("calc");const o=this.getSubsets();console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----");const t=this.getResult(o);return console.log("----\u7ED3\u679C\u8BA1\u7B97\u5B8C\u6210-----"),console.timeEnd("calc"),t}total(){const o=this.getOrder(this.productList),{balance:t,depositTotal:s,categoryCouponTotal:n}=o;return Object.assign(o,{balance:u(t-n),cutDeposit:u(t-s-n)})}getSubsets(){const o=[],t=this.productList.length;for(let s=0;s<1<<t;++s){const n=[];for(let r=0;r<t;++r)s&1<<r&&n.push(this.productList[r]);if(n.length){const r=this.getOrder(n);r&&o.push(r)}}return o}getOrder(o){const{threshold:t,off:s}=this.moneyOffSlnConfig,n=this.getStatictics(o),{moneyOffPriceTotal:r,categoryCouponCalc:c,depositTotal:l}=n,a=this.getCategoryCouponSln(c),i={order:o,...n,moneyOffTotal:u(Math.floor(r/t)*s),moneyOffDiff:u(r%t),...a},d=this.getBalance(i);return Object.assign(i,{balance:d,cutDeposit:u(d-l)}),i}static moneyOffCalc({price:o,moneyOffId:t},s){let n=0;if(t!==""){const{threshold:r,off:c}=s[t]||{};n=u(Math.floor(o/r)*c)}return n}static taoCoinCalc({price:o,taoCoin:t}){return t?u(o*t/100):0}getStatictics(o){return o.reduce((t,s)=>{var h;const{moneyOffId:n,price:r,categoryCouponType:c,deposit:l,cutPrice:a,productCoupon:i,taoCoin:d}=s;return t.total=u(t.total+r),t.depositTotal=u(t.depositTotal+l),t.cutPriceTotal=u(t.cutPriceTotal+a),t.productCouponTotal=u(t.productCouponTotal+i),n===this.moneyOffSlnConfig.id&&(t.moneyOffPriceTotal=t.moneyOffPriceTotal+r),c&&(t.categoryCouponCalc[c]=((h=t.categoryCouponCalc[c])!=null?h:0)+r),d&&(t.taoCoinTotal=t.taoCoinTotal+x.taoCoinCalc(s)),t},{total:0,moneyOffPriceTotal:0,depositTotal:0,cutPriceTotal:0,productCouponTotal:0,taoCoinTotal:0,categoryCouponCalc:{}})}getCategoryCouponSln(o){const t={categoryCoupon:[],categoryCouponTotal:0};return Object.entries(o).forEach(([s,n])=>{const{threshold:r}=this.categoryCouponConfig[s];n>=r&&(t.categoryCoupon.push(s),t.categoryCouponTotal=t.categoryCouponTotal+this.categoryCouponConfig[s].off)}),t}getBalance(o){const{total:t,moneyOffTotal:s,productCouponTotal:n,cutPriceTotal:r,taoCoinTotal:c}=o,l=t-s-n-c-r;return u(l)}getResult(o){const t=[];for(let s=0;s<o.length;s++){const n=o[s],{moneyOff:r,categoryCoupon:c,balance:l}=this.calcCon;let a=null;if(n.moneyOffDiff<=r.precision&&(a=n),a&&c.calc){n.balance=u(n.balance-n.categoryCouponTotal),a=null;const i=c.type.length;i===0?a=n:i<this.cateCouponLength?n.categoryCoupon.length>=i&&c.type.forEach(d=>{n.categoryCoupon.includes(d)&&(a=n)}):n.categoryCoupon.length===i&&(a=n)}if(a&&!c.calc&&(n.categoryCoupon=[],a=n),a&&l.calc){a=null;const{threshold:i,precision:d}=l;n.balance>=i&&n.balance-i<=d&&(n.balanceDiff=u(n.balance-i),a=n)}a&&(a.products=L.exports.orderBy(a.order,["brandId"],["desc"]).map(i=>i.productName).join("|"),t.push(a))}return t}}const $t={id:null,brandName:"",remark:"",shoppingCard:[]},qt={principal:0,gift:0,enabled:!1},At={brandName:[{required:!0,message:"\u8BF7\u8F93\u5165\u54C1\u724C\u540D\u79F0",trigger:"blur"}]},kt={id:null,productName:"",content:"",brandId:"",unitPrice:0,quantity:1,price:0,taoCoin:0,categoryCouponType:"",moneyOffId:0,voncher:!0,productCoupon:0,cutPrice:0,presale:!1,deposit:0,presaleTime:"",payTime:"",remark:""},Jt={productName:[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",trigger:"blur"}],brandId:[{required:!0,message:"\u8BF7\u9009\u62E9\u54C1\u724C",trigger:"change"}],unitPrice:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],quantity:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],productCoupon:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],taoCoin:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],cutPrice:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],deposit:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}]},D=[{id:0,couponName:"\u7F8E\u5986\u60CA\u559C\u5238",couponType:"makeup",threshold:1200,off:110,type:"success"},{id:1,couponName:"\u7CBE\u81F4\u751F\u6D3B\u5238",couponType:"life",threshold:200,off:15,type:"warning"},{id:2,couponName:"\u7F8E\u98DF\u60CA\u559C\u5238",couponType:"food",threshold:200,off:20,type:"info"}],Nt=[{id:0,threshold:1e3,off:50},{id:1,threshold:3800,off:300},{id:2,threshold:6800,off:520}],Y=[{id:0,label:"300-50",threshold:300,off:50}];class ${constructor({productList:o=[],calcCon:t={},moneyOffConfig:s,categoryCouponConfig:n}){Object.assign(this,{productList:o,calcCon:t,categoryCouponConfig:n}),this.moneyOffSlnConfig=s[t.moneyOff.id],this.cateCouponLength=Object.keys(this.categoryCouponConfig).length,this.productMap=m({array:this.productList,key:"id",value:"item"})}calc(){console.time("calc");const o=this.getSubsets();console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----");const t=this.getResult(o);return console.log("----\u7ED3\u679C\u8BA1\u7B97\u5B8C\u6210-----"),console.timeEnd("calc"),t}total(){const o=this.getOrder(this.productList),{balance:t,depositTotal:s,categoryCouponTotal:n}=o;return Object.assign(o,{balance:u(t-n),cutDeposit:u(t-s-n)})}getSubsets(){const o=[],t=this.productList.length;for(let s=0;s<1<<t;++s){const n=[];for(let r=0;r<t;++r)s&1<<r&&n.push(this.productList[r]);if(n.length){const r=this.getOrder(n);r&&o.push(r)}}return o}getOrder(o){const{threshold:t,off:s}=this.moneyOffSlnConfig,n=this.getStatictics(o),{moneyOffPriceTotal:r,categoryCouponCalc:c,depositTotal:l}=n,a=this.getCategoryCouponSln(c),i={order:o,...n,moneyOffTotal:u(Math.floor(r/t)*s),moneyOffDiff:u(r%t),...a},d=this.getBalance(i);return Object.assign(i,{balance:d,cutDeposit:u(d-l)}),i}static moneyOffCalc({price:o,moneyOffId:t},s){let n=0;if(t!==""){const{threshold:r,off:c}=s[t]||{};n=u(Math.floor(o/r)*c)}return n}static taoCoinCalc({price:o,taoCoin:t}){return t?u(o*t/100):0}getStatictics(o){return o.reduce((t,s)=>{var h;const{moneyOffId:n,price:r,categoryCouponType:c,deposit:l,cutPrice:a,productCoupon:i,taoCoin:d}=s;return t.total=u(t.total+r),t.depositTotal=u(t.depositTotal+l),t.cutPriceTotal=u(t.cutPriceTotal+a),t.productCouponTotal=u(t.productCouponTotal+i),n===this.moneyOffSlnConfig.id&&(t.moneyOffPriceTotal=t.moneyOffPriceTotal+r),c&&(t.categoryCouponCalc[c]=((h=t.categoryCouponCalc[c])!=null?h:0)+r),d&&(t.taoCoinTotal=t.taoCoinTotal+$.taoCoinCalc(s)),t},{total:0,moneyOffPriceTotal:0,depositTotal:0,cutPriceTotal:0,productCouponTotal:0,taoCoinTotal:0,categoryCouponCalc:{}})}getCategoryCouponSln(o){const t={categoryCoupon:[],categoryCouponTotal:0};return Object.entries(o).forEach(([s,n])=>{const{threshold:r}=this.categoryCouponConfig[s];n>=r&&(t.categoryCoupon.push(s),t.categoryCouponTotal=t.categoryCouponTotal+this.categoryCouponConfig[s].off)}),t}getBalance(o){const{total:t,moneyOffTotal:s,productCouponTotal:n,cutPriceTotal:r,taoCoinTotal:c}=o,l=t-s-n-c-r;return u(l)}getResult(o){const t=[];for(let s=0;s<o.length;s++){const n=o[s],{moneyOff:r,categoryCoupon:c,balance:l}=this.calcCon;let a=null;if(n.moneyOffDiff<=r.precision&&(a=n),a&&c.calc){n.balance=u(n.balance-n.categoryCouponTotal),a=null;const i=c.type.length;i===0?a=n:i<this.cateCouponLength?n.categoryCoupon.length>=i&&c.type.forEach(d=>{n.categoryCoupon.includes(d)&&(a=n)}):n.categoryCoupon.length===i&&(a=n)}if(a&&!c.calc&&(n.categoryCoupon=[],a=n),a&&l.calc){a=null;const{threshold:i,precision:d}=l;n.balance>=i&&n.balance-i<=d&&(n.balanceDiff=u(n.balance-i),a=n)}a&&(a.products=L.exports.orderBy(a.order,["brandId"],["desc"]).map(i=>i.productName).join("|"),t.push(a))}return t}static limitPriceBreakDiscount({price:o,balance:t,config:s}){const n={price:0,priceBreak:0,result:""};if(s){const{threshold:r,off:c}=s,l=u(o%r/r*c),a=u(Math.floor(o/r)*c),i=u(t-l),d=l+a;Object.assign(n,{price:i,priceBreak:d,result:`${i}|${d}`})}return n}}const wt=Ot("cart",{persist:!0,state:()=>({productList:[],productNextId:0,productSelectionList:[],brandList:[],orderList:[],prodFilterModel:{disableOrdered:!0,brandId:null},resultFilterModel:{moneyOff:{calc:!0,id:0,precision:0},categoryCoupon:{calc:!1,type:[]},balance:{calc:!1,threshold:1e3,precision:10}}}),getters:{voncherOptions(){return Nt.map(e=>Object.assign(e,{label:`${e.threshold}-${e.off}`,value:e.threshold}))},brandMapping(){const e=this.brandList.map(t=>Object.assign(t,{color:Mt()}));return new B({map:m({array:e,key:"id",value:"brandName"}),color:m({array:e,key:"id",value:"color"})})},categoryCouponMapping(){return new B({map:m({array:D,key:"couponType",value:"couponName"}),config:m({array:D,key:"couponType",value:"item"}),type:m({array:D,key:"couponType",value:"type"})})},moneyOffMapping(){return new B({map:m({array:Y,key:"id",value:"label"}),config:m({array:Y,key:"id",value:"item"})})},productListIndexs:e=>{const o={};return e.productList.forEach((t,s)=>{o[t.id]=s}),o},orderListIndexs:e=>{const o={};return e.orderList.forEach((t,s)=>{o[t.id]=s}),o},orderedProductIds:e=>e.orderList.reduce((t,s)=>(t.push(...s.order.map(n=>n.id)),t),[]),productShowList(){return L.exports.orderBy(this.productList.map(e=>{const{price:o,moneyOffId:t,productCoupon:s,cutPrice:n}=e,r=u(o-s-n-x.moneyOffCalc(e,this.moneyOffMapping.config)-x.taoCoinCalc(e));return e.categoryCouponType=e.categoryCouponType?e.categoryCouponType:"",Object.assign(L.exports.cloneDeep(e),{balance:r,moneyOffIdOrder:_t(t)?-1:t,moneyOffDesc:this.moneyOffMapping.map[t],taoCoinPer:e.taoCoin?`${e.taoCoin}%`:"-",depositDesc:e.deposit?e.deposit:"-",cutPriceDesc:e.cutPrice?e.cutPrice:"-",productCouponDesc:e.productCoupon?e.productCoupon:"-",limitPriceBreakPrice:$.limitPriceBreakDiscount({price:e.price,balance:r,config:this.moneyOffMapping.config[t]})})}).filter(e=>this.prodFilterModel.disableOrdered?!this.orderedProductIds.includes(e.id):e).filter(e=>this.prodFilterModel.brandId?e.brandId===this.prodFilterModel.brandId:e),["categoryCouponType","moneyOffIdOrder","payTime","balance"],["desc","desc","asc","desc"])},brandShowList(){return this.brandList.map(e=>{const{shoppingCard:o}=e,t=o?o.map(s=>{const{principal:n,gift:r,enabled:c}=s,l=+r+ +n,a=u(+n/l)*100;return`${c?"\u221A":""}${n}|${a}%`}).join(","):"";return Object.assign(L.exports.cloneDeep(e),{shoppingCardDesc:t})})}},actions:{exportAll(){this.exportOrderList(),this.saveProductList(),this.exportBrandList()},addOrder(e){const{order:o}=e;this.orderList.push({...e,id:H(),products:L.exports.orderBy(o,["brandId"],["desc"]).map(t=>t.productName).join("|")})},deleteOrder(e){const o=this.orderListIndexs[e.id];this.orderList.splice(o,1)},exportOrderList(){R(JSON.stringify(this.orderList,null,2),"json","orderList")},updateOrderList(e){this.orderList=e},updateProductSelectionList(e){this.productSelectionList=e},addProduct(e){const o={...e,id:this.productNextId},{productName:t}=o;this.productList.find(n=>n.productName===t)?J.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):(this.productList.push(o),this.productNextId=this.productNextId+1)},updateProduct(e){const o=this.productListIndexs[e.id];this.productList.splice(o,1,e)},deleteProduct(e){const o=this.productListIndexs[e.id];this.productList.splice(o,1)},formatProductList(){const e=[];return this.productList.forEach(o=>{const t={};for(const s in kt)t[s]=o[s];e.push(t)}),e},saveProductList(){R(JSON.stringify(this.formatProductList(),null,2),"json","shoppingCart")},importProductList(e){this.productList=e,this.productNextId=L.exports.last(e.sort((o,t)=>o.id-t.id)).id+1},addBrand(e){const o={...e,id:H()},{brandName:t}=o;this.brandList.find(n=>n.brandName===t)?J.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):this.brandList.push(o)},updateBrand(e,o){this.brandList.splice(o,1,e)},deleteBrand(e){this.brandList.splice(e,1)},exportBrandList(){R(JSON.stringify(this.brandList,null,2),"json","brandList")},importBrandList(e){this.brandList=e}}}),xt=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"})),Et=Object.assign({"./modules/cart.js":xt}),Rt={},Vt=()=>{Object.entries(Et).forEach(([e,o])=>{const t=e.replace(/(\.\/|\.js|.*\/)/g,"");Rt[t]=o.default()})};export{At as B,x as M,Jt as P,qt as S,kt as a,Pt as b,It as c,$t as d,Ut as e,vt as f,_t as i,Rt as m,u as r,Ft as s,Vt as u};
