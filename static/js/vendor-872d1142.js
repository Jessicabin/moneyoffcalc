var pt=Object.defineProperty;var ft=(t,o,e)=>o in t?pt(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var A=(t,o,e)=>(ft(t,typeof o!="symbol"?o+"":o,e),e);import{l as y}from"./lodash-8b651399.js";import{e as Y,r as W,m as x,w as ht,a as mt,i as T,b as $,t as K,d as gt,f as yt,g as Q,o as bt,n as Lt,h as Ct,j as Ot,E as X}from"./element-fc8b200b.js";var Pt=!1;/*!
  * pinia v2.0.23
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let Z;const E=t=>Z=t,tt=Symbol();function D(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var M;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(M||(M={}));function Xt(){const t=Y(!0),o=t.run(()=>W({}));let e=[],r=[];const s=x({install(n){E(s),s._a=n,n.provide(tt,s),n.config.globalProperties.$pinia=s,r.forEach(a=>e.push(a)),r=[]},use(n){return!this._a&&!Pt?r.push(n):e.push(n),this},_p:e,_a:null,_e:t,_s:new Map,state:o});return s}const et=()=>{};function J(t,o,e,r=et){t.push(o);const s=()=>{const n=t.indexOf(o);n>-1&&(t.splice(n,1),r())};return!e&&Q()&&bt(s),s}function S(t,...o){t.slice().forEach(e=>{e(...o)})}function F(t,o){t instanceof Map&&o instanceof Map&&o.forEach((e,r)=>t.set(r,e)),t instanceof Set&&o instanceof Set&&o.forEach(t.add,t);for(const e in o){if(!o.hasOwnProperty(e))continue;const r=o[e],s=t[e];D(s)&&D(r)&&t.hasOwnProperty(e)&&!T(r)&&!$(r)?t[e]=F(s,r):t[e]=r}return t}const _t=Symbol();function St(t){return!D(t)||!t.hasOwnProperty(_t)}const{assign:P}=Object;function kt(t){return!!(T(t)&&t.effect)}function jt(t,o,e,r){const{state:s,actions:n,getters:a}=o,c=e.state.value[t];let i;function d(){c||(e.state.value[t]=s?s():{});const p=Ct(e.state.value[t]);return P(p,n,Object.keys(a||{}).reduce((h,m)=>(h[m]=x(Ot(()=>{E(e);const b=e._s.get(t);return a[m].call(b,b)})),h),{}))}return i=ot(t,d,o,e,r,!0),i.$reset=function(){const h=s?s():{};this.$patch(m=>{P(m,h)})},i}function ot(t,o,e={},r,s,n){let a;const c=P({actions:{}},e),i={deep:!0};let d,p,h=x([]),m=x([]),b;const L=r.state.value[t];!n&&!L&&(r.state.value[t]={}),W({});let w;function G(l){let u;d=p=!1,typeof l=="function"?(l(r.state.value[t]),u={type:M.patchFunction,storeId:t,events:b}):(F(r.state.value[t],l),u={type:M.patchObject,payload:l,storeId:t,events:b});const O=w=Symbol();Lt().then(()=>{w===O&&(d=!0)}),p=!0,S(h,u,r.state.value[t])}const ct=et;function at(){a.stop(),h=[],m=[],r._s.delete(t)}function it(l,u){return function(){E(r);const O=Array.from(arguments),B=[],I=[];function lt(g){B.push(g)}function dt(g){I.push(g)}S(m,{args:O,name:l,store:C,after:lt,onError:dt});let v;try{v=u.apply(this&&this.$id===t?this:C,O)}catch(g){throw S(I,g),g}return v instanceof Promise?v.then(g=>(S(B,g),g)).catch(g=>(S(I,g),Promise.reject(g))):(S(B,v),v)}}const ut={_p:r,$id:t,$onAction:J.bind(null,m),$patch:G,$reset:ct,$subscribe(l,u={}){const O=J(h,l,u.detached,()=>B()),B=a.run(()=>ht(()=>r.state.value[t],I=>{(u.flush==="sync"?p:d)&&l({storeId:t,type:M.direct,events:b},I)},P({},i,u)));return O},$dispose:at},C=mt(ut);r._s.set(t,C);const j=r._e.run(()=>(a=Y(),a.run(()=>o())));for(const l in j){const u=j[l];if(T(u)&&!kt(u)||$(u))n||(L&&St(u)&&(T(u)?u.value=L[l]:F(u,L[l])),r.state.value[t][l]=u);else if(typeof u=="function"){const O=it(l,u);j[l]=O,c.actions[l]=u}}return P(C,j),P(K(C),j),Object.defineProperty(C,"$state",{get:()=>r.state.value[t],set:l=>{G(u=>{P(u,l)})}}),r._p.forEach(l=>{P(C,a.run(()=>l({store:C,app:r._a,pinia:r,options:c})))}),L&&n&&e.hydrate&&e.hydrate(C.$state,L),d=!0,p=!0,C}function R(t,o,e){let r,s;const n=typeof o=="function";typeof t=="string"?(r=t,s=n?e:o):(s=t,r=t.id);function a(c,i){const d=Q();return c=c||d&&gt(tt),c&&E(c),c=Z,c._s.has(r)||(n?ot(r,o,s,c):jt(r,s,c)),c._s.get(r)}return a.$id=r,a}function Zt(t){{t=K(t);const o={};for(const e in t){const r=t[e];(T(r)||$(r))&&(o[e]=yt(t,e))}return o}}let Bt=t=>crypto.getRandomValues(new Uint8Array(t)),It=(t,o,e)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,s=-~(1.6*r*o/t.length);return(n=o)=>{let a="";for(;;){let c=e(s),i=s;for(;i--;)if(a+=t[c[i]&r]||"",a.length===n)return a}}},vt=(t,o=21)=>It(t,o,Bt);const rt=()=>vt("1234567890abcdefghijklmnopqrstuvwxyz",8)(8),f=t=>Math.round(t*100)/100,k=(t=[])=>{let o=0;return t.filter(e=>e).forEach(e=>o=o+e),f(o)},U=(t,o,e="")=>{const r=new Blob([t],{type:`application/${o}`});if(e=`${e}.${o}`,window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(r,e);else{const s=document.createElement("a"),n=document.querySelector("body");s.href=window.URL.createObjectURL(r),s.download=e,s.style.display="none",n.appendChild(s),s.click(),n.removeChild(s),window.URL.revokeObjectURL(s.href)}},_=({array:t=[],map:o={},key:e="id",value:r="item"})=>(t.forEach(s=>{const n=e?s[e]:s,a=r==="item"?s:s[r];o[n]=a}),o),Mt=t=>typeof t=="string",te=t=>typeof t=="number",Nt=t=>Object.prototype.toString.call(t)==="[object Object]",Tt=t=>Object.prototype.toString.call(t)==="[object Array]",ee=t=>t==null||Mt(t)&&t===""||Tt(t)&&t.length===0||Nt(t)&&Object.keys(t).length===0,oe=t=>new Promise(o=>{const e=new FileReader;e.readAsText(t),e.onload=r=>{const s=JSON.parse(r.target.result);o(s)}}),Rt=()=>"#"+Math.floor(Math.random()*16777215).toString(16),V={id:null,brandName:"",brandType:null,remark:"",shoppingCard:[]},re={principal:0,total:0,enabled:!1},se={brandName:[{required:!0,message:"\u8BF7\u8F93\u5165\u54C1\u724C\u540D\u79F0",trigger:"blur"}]},z=[{id:0,brandTypeName:"\u5316\u5986\u54C1",color:"#CC6699"},{id:1,brandTypeName:"\u98DF\u54C1",color:"#003366"},{id:2,brandTypeName:"\u670D\u9970",color:"#CC6600"},{id:3,brandTypeName:"\u5BB6\u7535",color:"#336633"},{id:4,brandTypeName:"\u5BB6\u5177",color:"#996666"},{id:5,brandTypeName:"\u9910\u996E\u5177",color:"#669933"}],H={id:null,productName:"",content:"",brandId:"",unitPrice:0,quantity:1,price:0,remark:"",taoCoin:0,taoCoinPrice:0,vipDiscount:!1,vipDiscountPrice:0,productCoupon:0,realPrice:0,categoryCouponType:"",moneyOffId:"",useVoncher:!0,presale:!1,deposit:0,presaleTime:"",payTime:""},ne={productName:[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",trigger:"blur"}],brandId:[{required:!0,message:"\u8BF7\u9009\u62E9\u54C1\u724C",trigger:"change"}],unitPrice:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],quantity:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],productCoupon:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],taoCoin:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],deposit:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}]},wt=[{id:1,couponName:"\u7F8E\u5986\u60CA\u559C\u5238",couponType:"makeup",threshold:1200,off:110,type:"success"},{id:2,couponName:"\u7CBE\u81F4\u751F\u6D3B\u5238",couponType:"life",threshold:200,off:15,type:"warning"},{id:3,couponName:"\u7F8E\u98DF\u60CA\u559C\u5238",couponType:"food",threshold:200,off:20,type:"info"}],xt=[{id:4,threshold:300,off:15,times:1},{id:5,threshold:1500,off:120,times:1},{id:6,threshold:5e3,off:400,times:1}],Et=[{id:1,threshold:300,off:50},{id:2,threshold:200,off:30}];class N{constructor(o={}){var e;Object.assign(this,o),this.map=(e=this.map)!=null?e:{},this.options=this.getOptions()}getOptions(){const o=[];if(Object.keys(this.map).length)for(let e in this.map){/^[0-9]*$/.test(e)&&(e=+e);let r={label:this.map[e],value:e};o.push(r)}return o}}const Dt=R("brand",{state:()=>({brandList:[]}),persist:{paths:["brandList"]},getters:{brandShowList(){const t=this.brandList.map(o=>{const{shoppingCard:e}=o,r=e?e.map(s=>{const{principal:n,total:a,enabled:c}=s,i=y.exports.round(n/a,4)*100;return`${c?"\u221A":""}${n}|${i}%`}).join(","):"";return Object.assign(y.exports.cloneDeep(o),{shoppingCardDesc:r})});return y.exports.orderBy(t,["brandType","shoppingCard"],["asc","desc"])},brandMapping(){const t=this.brandList.map(e=>Object.assign(e,{color:Rt()}));return new N({map:_({array:t,key:"id",value:"brandName"}),color:_({array:t,key:"id",value:"color"})})},brandTypeMapping(){return new N({map:_({array:z,key:"id",value:"brandTypeName"}),color:_({array:z,key:"id",value:"color"})})}},actions:{addBrand(t){const o={...t,id:rt()};this.brandList.find(r=>r.brandName===o.brandName)?X.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):this.brandList.push(this.format(o))},updateBrand(t,o){this.brandList.splice(o,1,t)},deleteBrand(t){this.brandList.splice(t,1)},exportBrandList(){const t=JSON.stringify(this.formatList(),null,2);U(t,"json","brandList")},importBrandList(t){this.brandList=t.map(o=>this.format(o))},format(t){var e;const o={};for(const r in V)o[r]=(e=t[r])!=null?e:V[r];return o},formatList(){return this.brandList.map(t=>this.format(t))}}}),Ft=Object.freeze(Object.defineProperty({__proto__:null,default:Dt},Symbol.toStringTag,{value:"Module"})),q=R("coupon",{persist:!1,state:()=>({voncherList:xt,categoryCouponList:wt,priceBreakList:Et}),getters:{voncherMapping(){const t={},o={};return this.voncherList.forEach(e=>{t[e.id]=`${e.threshold}-${e.off}`,o[e.id]=e}),new N({map:t,config:o})},categoryCouponMapping(){return new N({map:_({array:this.categoryCouponList,key:"couponType",value:"couponName"}),config:_({array:this.categoryCouponList,key:"couponType",value:"item"}),type:_({array:this.categoryCouponList,key:"couponType",value:"type"})})},priceBreakMapping(){const t={},o={};return this.priceBreakList.forEach(e=>{const{id:r,threshold:s,off:n}=e;t[r]=`\u6BCF${s}\u51CF${n}`,o[r]=e}),new N({map:t,config:o})},priceBreakDesc(){return t=>{var o;return(o=this.priceBreakMapping.map[t.moneyOffId])!=null?o:""}}},actions:{}}),$t=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"})),st=R("product",{state:()=>({productList:[],productNextId:0,prodFilterModel:{disableOrdered:!1,brandId:null,payTime:""}}),persist:{paths:["productList","productNextId","prodFilterModel"]},getters:{filterCondition(){return()=>{const t={},{brandId:o,payTime:e}=this.prodFilterModel;return o&&(t.brandId=o),e&&(t.payTime=e),t}},productIdMap(){const t={};return this.productList.forEach(o=>{t[o.id]=o}),t},productListIndexs:t=>{const o={};return t.productList.forEach((e,r)=>{o[e.id]=r}),o},productShowList(){const o=q().priceBreakMapping.config,e=this.productList.map(a=>{const{moneyOffId:c,price:i,realPrice:d}=a,{threshold:p,off:h}=o[c]||{},m=c?f(Math.floor(i/p)*h):0,b=c?f(i%p/p*h)+m:0,L=f(d-m),w=c?f(d-b):"-";return Object.assign(y.exports.cloneDeep(a),{taoCoinPer:a.taoCoin?`${a.taoCoin}%`:"-",depositDesc:a.deposit?a.deposit:"-",productCouponDesc:a.productCoupon?a.productCoupon:"-",referencePrice:L,referencePriceByPriceBreakLimit:w})}),r=nt(),s=y.exports.filter(e,this.filterCondition()).filter(a=>this.prodFilterModel.disableOrdered?!r.orderedProductIds.includes(a.id):a);return y.exports.orderBy(s,["categoryCouponType","moneyOffId","brandId"],["desc","desc","desc"])}},actions:{addProduct(t){const o={...t,id:this.productNextId};this.productList.find(r=>r.productName===o.productName)?X.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):(this.productList.push(this.format(o)),this.productNextId=this.productNextId+1)},updateProduct(t){const o=this.productListIndexs[t.id];this.productList.splice(o,1,this.format(t))},deleteProduct(t){const o=this.productListIndexs[t.id];this.productList.splice(o,1)},format(t){var e;const o={};for(const r in H)o[r]=(e=t[r])!=null?e:H[r];return o},exportProductList(){const t=JSON.stringify(this.formatList(),null,2);U(t,"json","productList")},importProductList(t){this.productList=t.map(o=>this.format(o)),this.productNextId=y.exports.last(t.sort((o,e)=>o.id-e.id)).id+1},formatList(){return this.productList.map(t=>this.format(t))}}}),Ut=Object.freeze(Object.defineProperty({__proto__:null,default:st},Symbol.toStringTag,{value:"Module"}));class ce{constructor({productList:o=[],calcCon:e={},moneyOffConfig:r,categoryCouponConfig:s,voncherMapping:n}){Object.assign(this,{productList:o,calcCon:e,moneyOffConfig:r,categoryCouponConfig:s,voncherMapping:n})}calc(){console.time("calc");const o=this.getSubsets();console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----");const e=this.getResult(o);return console.log("----\u7ED3\u679C\u8BA1\u7B97\u5B8C\u6210-----"),console.timeEnd("calc"),e}getSubsets(){const o=[],e=this.productList.length;for(let r=0;r<1<<e;++r){const s=[];for(let n=0;n<e;++n)r&1<<n&&s.push(this.productList[n]);if(s.length){const n=this.getOrder(s);n&&o.push(n)}}return o}getOrder(o){const{total:e,totalRealPrice:r,categoryCouponGroup:s,priceBreakGroup:n}=this.getStatictics(o),{categoryCoupons:a,categoryCouponTotal:c}=this.getCategoryCouponSln(s),{totalPriceBreakPrice:i,priceBreakTotal:d,priceBreakDiff:p}=this.getPriceBreakSln(n);return{order:o,total:e,totalPriceBreakPrice:i,priceBreakDiff:p,categoryCoupons:a,categoryCouponTotal:c,balance:f(r-d-c)}}getStatictics(o){return o.reduce((e,r)=>{var i,d;const{price:s,realPrice:n,categoryCouponType:a,moneyOffId:c}=r;return e.total=f(e.total+s),e.totalRealPrice=f(e.totalRealPrice+n),a&&(e.categoryCouponGroup[a]=((i=e.categoryCouponGroup[a])!=null?i:0)+s),c&&(e.priceBreakGroup[c]=((d=e.priceBreakGroup[c])!=null?d:0)+s),e},{total:0,totalRealPrice:0,categoryCouponGroup:{},priceBreakGroup:{}})}getPriceBreakSln(o){const e={totalPriceBreakPrice:0,priceBreakTotal:0,priceBreakDiff:0};for(const r in o){const s=o[r],{threshold:n,off:a}=this.moneyOffConfig[r];e.totalPriceBreakPrice=f(e.totalPriceBreakPrice+s),e.priceBreakTotal=f(e.priceBreakTotal+Math.floor(s/n)*a),e.priceBreakDiff=f(e.priceBreakDiff+s%n)}return e}getCategoryCouponSln(o){const e={categoryCoupons:[],categoryCouponTotal:0};for(const r in o){const{categoryCoupon:{calc:s,type:n}}=this.calcCon,{threshold:a,off:c}=this.categoryCouponConfig[r];s&&o[r]>=a&&(n.length===0||n.length&&n.includes(r))&&(e.categoryCoupons.push(r),e.categoryCouponTotal=f(e.categoryCouponTotal+c))}return e}getResult(o){const e=[];for(let r=0;r<o.length;r++){const s=o[r],{moneyOff:n,balance:a}=this.calcCon;let c=null;if(s.priceBreakDiff<=n.diff&&(c=s),c&&a.calc){c=null;const{threshold:i}=this.voncherMapping.config[a.id];s.balance>=i&&s.balance-i<=a.diff&&(s.balanceDiff=f(s.balance-i),c=s)}c&&(c.products=y.exports.orderBy(c.order,["brandId"],["desc"]).map(i=>i.productName).join("|"),e.push(c))}return e}}class qt{constructor(){A(this,"calc",({order:o={},config:e={}})=>{Object.assign(this,e,o);const{products:r=[],categoryCoupons:s=[]}=o,n={totalPrice:k(r.map(c=>c.price)),totalPriceBreakPrice:0,totalRealPrice:k(r.map(c=>c.realPrice)),totalDepositPrice:k(r.map(c=>c.deposit)),totalProductCoupon:k(r.map(c=>c.productCoupon)),balance:0},a=y.exports.groupBy(r,c=>c.moneyOffId);if(Object.entries(a).map(([c,i])=>{const d=e.priceBreakMapping.config[c];if(d){const{threshold:p,off:h}=d,m=k(i.map(L=>L.price)),b=f(Math.floor(m/p)*h);Object.assign(n,{totalPriceBreakPrice:m,totalRealPrice:f(n.totalRealPrice-b)})}}),s.length){const c=k(s.map(i=>e.categoryCouponMapping.config[i].off));Object.assign(n,{totalRealPrice:n.totalRealPrice-c})}return n.balance=n.totalRealPrice-n.totalDepositPrice,n})}}const Gt=new qt,At=Gt.calc,nt=R("order",{persist:!0,state:()=>({orderList:[]}),getters:{orderListIndexs(){const t={};return this.orderList.forEach((o,e)=>{t[o.id]=e}),t},orderedProductIds(){return this.orderList.reduce((o,e)=>(o.push(...e.productIds),o),[])},orderShowList(){const t=st(),o=q();return this.orderList.map(e=>{const r=y.exports.orderBy(e.productIds.map(n=>t.productIdMap[n]),["brandId"],["desc"]),s=At({order:{products:r,categoryCoupons:e.categoryCoupons},config:{categoryCouponMapping:o.categoryCouponMapping,priceBreakMapping:o.priceBreakMapping}});return Object.assign(y.exports.cloneDeep(e),{...s,products:r.map(n=>n.productName).join("|")})})}},actions:{addOrder(t){const{order:o,categoryCoupons:e=[]}=t;this.orderList.push({id:rt(),productIds:o.map(r=>r.id),categoryCoupons:e})},deleteOrder(t){this.orderList.splice(this.orderListIndexs[t.id],1)},exportOrderList(){const t=JSON.stringify(this.formatList(),null,2);U(t,"json","orderList")},importOrderList(t){this.orderList=t},formatList(){return JSON.parse(JSON.stringify(this.orderList))}}}),Jt=Object.freeze(Object.defineProperty({__proto__:null,default:nt},Symbol.toStringTag,{value:"Module"})),Vt=R("cart",{persist:!1,state:()=>({productSelectionList:[],resultFilterModel:{moneyOff:{calc:!0,id:1,diff:0},categoryCoupon:{calc:!1,type:[]},balance:{calc:!1,id:4,diff:10}}}),getters:{},actions:{updateProductSelectionList(t){this.productSelectionList=t}}}),zt=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"})),Ht=Object.assign({"./modules/brand.js":Ft,"./modules/coupon.js":$t,"./modules/order.js":Jt,"./modules/product.js":Ut,"./modules/result.js":zt}),Yt={},ae=()=>{Object.entries(Ht).forEach(([t,o])=>{const e=t.replace(/(\.\/|\.js|.*\/)/g,"");Yt[e]=o.default()})};export{se as B,At as O,ne as P,re as S,H as a,oe as b,V as c,ce as d,U as e,Xt as f,Mt as g,Tt as h,ee as i,te as j,Yt as m,f as r,Zt as s,ae as u};
