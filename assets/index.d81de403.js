var X=Object.defineProperty;var Y=(n,e,t)=>e in n?X(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var z=(n,e,t)=>(Y(n,typeof e!="symbol"?e+"":e,t),t);import{af as p,l as h,m as O,p as v,W as a,F as L,av as K,aw as W,ax as Z,P as k,Q as s,U as g,a5 as x,ay as R,e as N,a as U,V as D,T as F,_ as I,$ as j,c as $,ai as ee,R as oe,ab as P,az as te,aA as le,as as ne,aB as ae,aC as re}from"./vue.52e69934.js";import{a as se,l as E}from"./utils.11921c2f.js";import{E as B,a as ie,i as ce}from"./ele.49b9e069.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const M=(n,e)=>{const t=n.__vccOpts||n;for(const[l,o]of e)t[l]=o;return t},de={},ue=n=>(K("data-v-a5ac23ae"),n=n(),W(),n),pe=ue(()=>v("header",null," \u5929\u732B\u6EE1\u51CF\u8BA1\u7B97 ",-1));function fe(n,e){const t=p("RouterView");return h(),O(L,null,[pe,v("main",null,[a(t)])],64)}const me=M(de,[["render",fe],["__scopeId","data-v-a5ac23ae"]]),_e=()=>se("1234567890abcdefghijklmnopqrstuvwxyz",8)(8),ye=function(n){console.time("subsets");const e=[],t=n.length;for(let l=0;l<1<<t;++l){const o=[];for(let r=0;r<t;++r)l&1<<r&&o.push(n[r]);o.length&&e.push(o)}return console.log(e.length),console.timeEnd("subsets"),e},J=(n,e,t="")=>{const l=new Blob([n],{type:`application/${e}`});if(t=`${t}.${e}`,window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(l,t);else{const o=document.createElement("a"),r=document.querySelector("body");o.href=window.URL.createObjectURL(l),o.download=t,o.style.display="none",r.appendChild(o),o.click(),r.removeChild(o),window.URL.revokeObjectURL(o.href)}},V=({array:n=[],map:e={},key:t="id",value:l="item"})=>(n.forEach(o=>{const r=t?o[t]:o,i=l==="item"?o:o[l];e[r]=i}),e);class q{constructor(e={}){var t;Object.assign(this,e),this.map=(t=this.map)!=null?t:{},this.options=this.getOptions()}getOptions(){const e=[];if(Object.keys(this.map).length)for(let t in this.map){/^[0-9]*$/.test(t)&&(t=+t);let l={label:this.map[t],value:t};e.push(l)}return e}}const he=Z("cart",{state:()=>({productList:[],productSelectionList:[],brandList:[],categoryCouponList:[{id:0,couponName:"\u7F8E\u5986\u60CA\u559C\u5238",couponType:"makeup",threshold:1200,off:110},{id:1,couponName:"\u7CBE\u81F4\u751F\u6D3B\u5238",couponType:"life",threshold:200,off:15}],moneyOffList:[{id:0,label:"300-50",threshold:300,off:50}],productNextId:0,voncherOptions:[{label:"1000-50",value:1e3},{label:"3800-300",value:3800},{label:"6800-300",value:6800}]}),getters:{brandMapping:n=>new q({map:V({array:n.brandList,key:"id",value:"brandName"})}),categoryCouponMapping:n=>new q({map:V({array:n.categoryCouponList,key:"couponType",value:"couponName"}),config:V({array:n.categoryCouponList,key:"couponType",value:"item"})}),moneyOffMapping:n=>new q({map:V({array:n.moneyOffList,key:"id",value:"label"}),config:V({array:n.moneyOffList,key:"id",value:"item"})})},actions:{updateProductSelectionList(n){this.productSelectionList=n},addProduct(n){const e={...n,id:this.productNextId},{productName:t}=e;this.productList.find(o=>o.productName===t)?B.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):(this.productList.push(e),this.productNextId=this.productNextId+1)},updateProduct(n,e){this.productList.splice(e,1,n)},deleteProduct(n){this.productList.splice(n,1)},saveProductList(){J(JSON.stringify(this.productList,null,2),"json","shoppingCart")},importProductList(n){this.productList=n,this.productNextId=E.exports.last(n.sort((e,t)=>e.id-t.id)).id+1},addBrand(n){const e={...n,id:_e()},{brandName:t}=e;this.brandList.find(o=>o.brandName===t)?B.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):this.brandList.push(e)},updateBrand(n,e){this.brandList.splice(e,1,n)},deleteBrand(n){this.brandList.splice(n,1)},saveBrandList(){J(JSON.stringify(this.brandList,null,2),"json","brandList")},importBrandList(n){this.brandList=n}},persist:!0});function T(){return{cart:he()}}const ge={brandName:"",remark:""},be={brandName:[{required:!0,message:"\u8BF7\u8F93\u5165\u54C1\u724C\u540D\u79F0",trigger:"blur"}]},Ce={productName:"",brandId:null,unitPrice:0,quantity:1,price:0,categoryCouponType:null,moneyOffId:0,productCoupon:0,cutPrice:0,deposit:0,remark:""},ve={productName:[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",trigger:"blur"}],brandId:[{required:!0,message:"\u8BF7\u9009\u62E9\u54C1\u724C",trigger:"change"}],unitPrice:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],quantity:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],productCoupon:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],cutPrice:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],deposit:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}]},Oe={data(){return{dialogVisible:!1,formModel:{},rules:ve}},setup(){const{cart:n}=T(),e=n.categoryCouponMapping.options,t=n.moneyOffMapping.options;return{cart:n,categoryCouponOptions:e,moneyOffOptions:t}},methods:{initDialog({row:n,index:e}={}){this.dialogVisible=!0,this.isAdd=!n,this.formModel=E.exports.cloneDeep(n||Ce),this.index=e},closeDialog(){this.dialogVisible=!1},async handleConfirm(){await this.$refs.form.validate((n,e)=>{if(n){const{unitPrice:t,quantity:l}=this.formModel;Object.assign(this.formModel,{price:t*1e4*l/1e4}),this.isAdd?this.cart.addProduct(this.formModel):this.cart.updateProduct(this.formModel,this.index),this.closeDialog()}else console.log("error submit!",e)})}}},ke={class:"dialog-footer"};function we(n,e,t,l,o,r){const i=p("el-input"),d=p("el-form-item"),c=p("el-option"),u=p("el-select"),_=p("el-input-number"),y=p("el-form"),C=p("el-button"),m=p("el-dialog");return h(),k(m,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[10]||(e[10]=f=>o.dialogVisible=f),title:"\u65B0\u589E",width:"30%","destroy-on-close":"",center:""},{footer:s(()=>[v("span",ke,[a(C,{onClick:r.closeDialog},{default:s(()=>[g("\u53D6\u6D88")]),_:1},8,["onClick"]),a(C,{type:"primary",onClick:r.handleConfirm},{default:s(()=>[g(" \u786E\u5B9A ")]),_:1},8,["onClick"])])]),default:s(()=>[a(y,{ref:"form","label-width":"100px",model:o.formModel,rules:o.rules},{default:s(()=>[a(d,{label:"\u5546\u54C1\u540D\u79F0",prop:"productName"},{default:s(()=>[a(i,{modelValue:o.formModel.productName,"onUpdate:modelValue":e[0]||(e[0]=f=>o.formModel.productName=f)},null,8,["modelValue"])]),_:1}),a(d,{label:"\u54C1\u724C",prop:"brandId"},{default:s(()=>[a(u,{modelValue:o.formModel.brandId,"onUpdate:modelValue":e[1]||(e[1]=f=>o.formModel.brandId=f),placeholder:"\u8BF7\u9009\u62E9\u54C1\u724C"},{default:s(()=>[(h(!0),O(L,null,x(l.cart.brandMapping.options,f=>(h(),k(c,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u5355\u4EF7",prop:"unitPrice"},{default:s(()=>[a(_,{modelValue:o.formModel.unitPrice,"onUpdate:modelValue":e[2]||(e[2]=f=>o.formModel.unitPrice=f),step:.01},null,8,["modelValue","step"])]),_:1}),a(d,{label:"\u6570\u91CF",prop:"quantity"},{default:s(()=>[a(_,{min:1,modelValue:o.formModel.quantity,"onUpdate:modelValue":e[3]||(e[3]=f=>o.formModel.quantity=f)},null,8,["modelValue"])]),_:1}),a(d,{label:"\u54C1\u7C7B\u5238\u7C7B\u578B",prop:"categoryCouponType"},{default:s(()=>[a(u,{modelValue:o.formModel.categoryCouponType,"onUpdate:modelValue":e[4]||(e[4]=f=>o.formModel.categoryCouponType=f),placeholder:"\u8BF7\u9009\u62E9\u54C1\u7C7B\u5238\u7C7B\u578B"},{default:s(()=>[(h(!0),O(L,null,x(l.categoryCouponOptions,f=>(h(),k(c,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u6EE1\u51CF\u7C7B\u578B",prop:"moneyOffId"},{default:s(()=>[a(u,{modelValue:o.formModel.moneyOffId,"onUpdate:modelValue":e[5]||(e[5]=f=>o.formModel.moneyOffId=f),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6EE1\u51CF\u7C7B\u578B"},{default:s(()=>[(h(!0),O(L,null,x(l.moneyOffOptions,f=>(h(),k(c,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u5546\u54C1\u5238\u91D1\u989D",prop:"productCoupon"},{default:s(()=>[a(i,{modelValue:o.formModel.productCoupon,"onUpdate:modelValue":e[6]||(e[6]=f=>o.formModel.productCoupon=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(d,{label:"\u62CD\u4E0B\u7ACB\u51CF\u91D1\u989D",prop:"cutPrice"},{default:s(()=>[a(i,{modelValue:o.formModel.cutPrice,"onUpdate:modelValue":e[7]||(e[7]=f=>o.formModel.cutPrice=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(d,{label:"\u5B9A\u91D1",prop:"deposit"},{default:s(()=>[a(i,{modelValue:o.formModel.deposit,"onUpdate:modelValue":e[8]||(e[8]=f=>o.formModel.deposit=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(d,{label:"\u5907\u6CE8",prop:"remark"},{default:s(()=>[a(i,{type:"textarea",modelValue:o.formModel.remark,"onUpdate:modelValue":e[9]||(e[9]=f=>o.formModel.remark=f)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}const Me=M(Oe,[["render",we]]);class H{constructor({productList:e=[],calcCon:t={},moneyOffConfig:l,categoryCouponConfig:o}){z(this,"getOrders",(e=[])=>{const{threshold:t,off:l}=this.moneyOffSlnConfig,o=V({array:this.productList,key:"id",value:"item"});return new Promise(r=>{const i=[];for(let d=0;d<e.length;d++){const c=e[d],u=c.map(S=>o[S]),_=this.getStatictics(u),{moneyOffPriceTotal:y,categoryCouponCalc:C,depositTotal:m}=_,f=this.getCategoryCouponSln(C),b=Object.assign(c,{order:u,..._,moneyOffTotal:Math.floor(y/t)*l,moneyOffDiff:Math.round(y%t*1e4)/1e4,...f}),w=this.getBalance(b);Object.assign(b,{balance:w,cutDeposit:w-m}),b.moneyOffDiff<=this.calcCon.moneyOff.precision&&i.push(b)}r(i)})});Object.assign(this,{productList:e,calcCon:t,categoryCouponConfig:o}),this.moneyOffSlnConfig=l[t.moneyOff.id],this.productMap=V({array:this.productList,key:"id",value:"item"})}async calc(){console.time("calc");const e=this.getSubsets();console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----");const t=await this.getResult(e);return console.log("----\u7ED3\u679C\u8BA1\u7B97\u5B8C\u6210-----"),console.timeEnd("calc"),Promise.resolve(t)}async total(){return this.getOrder(this.productList)}getSubsets(){const e=[],t=this.productList.length;for(let l=0;l<1<<t;++l){const o=[];for(let r=0;r<t;++r)l&1<<r&&o.push(this.productList[r]);if(o.length){const r=this.getOrder(o);r&&e.push(r)}}return e}getOrder(e){const{threshold:t,off:l}=this.moneyOffSlnConfig,o=this.getStatictics(e),{moneyOffPriceTotal:r,categoryCouponCalc:i,depositTotal:d}=o,c=this.getCategoryCouponSln(i),u={order:e,...o,moneyOffTotal:Math.floor(r/t)*l,moneyOffDiff:Math.round(r%t),...c},_=this.getBalance(u);return Object.assign(u,{balance:_,cutDeposit:_-d}),u}getStatictics(e){return e.reduce((t,l)=>{const{moneyOffId:o,price:r,categoryCouponType:i,deposit:d,cutPrice:c,productCoupon:u}=l;return t.total=t.total+r,t.depositTotal=t.depositTotal+d,t.cutPriceTotal=t.cutPriceTotal+c,t.productCouponTotal=t.productCouponTotal+u,o===this.moneyOffSlnConfig.id&&(t.moneyOffPriceTotal=t.moneyOffPriceTotal+r),i&&(t.categoryCouponCalc[i]=t.categoryCouponCalc[i]+r),t},{total:0,moneyOffPriceTotal:0,depositTotal:0,cutPriceTotal:0,productCouponTotal:0,categoryCouponCalc:{life:0,makeup:0}})}getCategoryCouponSln(e){const t={categoryCoupon:[],categoryCouponTotal:0};return Object.entries(e).forEach(([l,o])=>{const{threshold:r}=this.categoryCouponConfig[l];o>=r&&(t.categoryCoupon.push(l),t.categoryCouponTotal=t.categoryCouponTotal+this.categoryCouponConfig[l].off)}),t}getBalance(e){const{total:t,moneyOffTotal:l,categoryCouponTotal:o,productCouponTotal:r,cutPriceTotal:i}=e,d=t-l-o-r-i;return Math.round(d*1e4)/1e4}async getResult(e){const t=[];for(let l=0;l<e.length;l++){const o=e[l],{order:r}=o;o.products=r.map(u=>u.productName).join("|");const{balance:i,categoryCoupon:d}=this.calcCon;let c=o;if(o.moneyOffDiff<=this.calcCon.moneyOff.precision?c=o:c=null,c&&d.type&&(o.categoryCoupon.includes(d.type)?c=o:c=null),c&&i.calc){const{threshold:u,precision:_}=i;o.balance>=u&&o.balance-u<=_?(o.balanceDiff=o.balance-u,c=o):c=null}c&&t.push(c)}return console.log(t),this.calcCon.balance.calc?t.sort((l,o)=>l.balanceDiff-o.balanceDiff):t.sort((l,o)=>l.moneyOffDiff-o.moneyOffDiff),t}async _getSubsets(){const e=this.getIdSubsets();console.log("----\u5546\u54C1ID\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210------");const t=await this.getOrders(e);return console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----"),t}getIdSubsets(){return ye(this.productList.map(e=>e.id))}}const Ve={components:{AddProduct:Me},data(){return{columns:[]}},setup(){const{cart:n}=T(),{productList:e,brandList:t}=R(n),l=N(()=>n.categoryCouponMapping),o=N(()=>n.moneyOffMapping),r=u=>{n.updateProductSelectionList(u)},i=async()=>{const _=await new H({productList:e.value,calcCon:{moneyOff:{id:0}},moneyOffConfig:o.value.config,categoryCouponConfig:l.value.config}).total(),{balance:y,depositTotal:C,cutDeposit:m}=_;ie.alert(`\u5B9E\u4ED8\uFF1A${y} \u5DF2\u4ED8\u5B9A\u91D1\uFF1A${C}  \u5C3E\u6B3E\u5B9E\u4ED8\uFF1A${m}`,"\u8D2D\u7269\u8F66\u603B\u5B9E\u4ED8\u6B3E")},d=U("");return{filterTableData:N(()=>e.value.map(u=>{const{price:_,moneyOffId:y,productCoupon:C,cutPrice:m}=u,f=_-C-m;let b=0;if(y!==""){const{threshold:w,off:S}=o.value.config[y]||{};b=Math.floor(_/w)*S}return Object.assign(u,{balance:f-b})})),search:d,cart:n,brandList:t,categoryCouponMapping:l,moneyOffMapping:o,handleSelectionChange:r,handleCalcTotal:i}},created(){this.generateColumns()},methods:{handleAddOrUpdate(n){this.$refs.add.initDialog(n)},handleBeforeUpload(n){const e=new FileReader;e.readAsText(n),e.onload=t=>{const l=JSON.parse(t.target.result);this.cart.importProductList(l)}},generateColumns(){const n=[{key:"id",title:"ID",width:50},{key:"productName",title:"\u5546\u54C1\u540D",width:200},{key:"price",title:"\u6D3B\u52A8\u4EF7",width:100,sortable:!0},{key:"balance",title:"\u5B9E\u4ED8",width:100},{key:"categoryCouponType",title:"\u54C1\u7C7B\u5238",width:100},{key:"moneyOffId",title:"\u6EE1\u51CF\u6D3B\u52A8",width:100},{key:"productCoupon",title:"\u5546\u54C1\u5238",width:100},{key:"cutPrice",title:"\u62CD\u4E0B\u7ACB\u51CF",width:100},{key:"deposit",title:"\u5B9A\u91D1",width:100},{key:"operations",type:"oper",title:"\u64CD\u4F5C",width:100}];this.columns=n.map(e=>{const{key:t,type:l}=e;return Object.assign(e,{props:t,dataKey:l?void 0:t})})}}},Le={class:"cart__wrapper"},xe={style:{display:"flex",gap:"10px"}},Te={class:"cart-table__wrapper"};function Se(n,e,t,l,o,r){const i=p("el-button"),d=p("el-upload"),c=p("el-table-column"),u=p("el-tag"),_=p("el-table"),y=p("el-auto-resizer"),C=p("add-product");return h(),O("div",Le,[v("div",xe,[a(i,{type:"primary",disabled:!l.brandList.length,onClick:r.handleAddOrUpdate},{default:s(()=>[g("\u65B0\u589E\u5546\u54C1")]),_:1},8,["disabled","onClick"]),a(i,{type:"primary",onClick:l.cart.saveProductList},{default:s(()=>[g("\u5BFC\u51FA")]),_:1},8,["onClick"]),a(d,{accept:".json","show-file-list":!1,action:"#",beforeUpload:r.handleBeforeUpload},{trigger:s(()=>[a(i,null,{default:s(()=>[g(" \u5BFC\u5165 ")]),_:1})]),_:1},8,["accept","beforeUpload"]),a(i,{class:"ml10",onClick:l.handleCalcTotal},{default:s(()=>[g("\u603B\u5B9E\u4ED8\u6B3E")]),_:1},8,["onClick"])]),v("div",Te,[a(y,null,{default:s(({height:m,width:f})=>[a(_,{data:l.filterTableData,width:f,height:m,ref:"table",onSelectionChange:l.handleSelectionChange},{default:s(()=>[a(c,{type:"selection",width:"55"}),a(c,{prop:"id",label:"ID",width:"50"}),a(c,{prop:"productName",label:"\u5546\u54C1\u540D",width:"180"}),a(c,{prop:"categoryCouponType",label:"\u54C1\u7C7B\u5238",width:"120",sortable:""},{default:s(({row:b})=>[b.categoryCouponType?(h(),k(u,{key:0,effect:"plain"},{default:s(()=>[g(D(l.categoryCouponMapping.map[b.categoryCouponType]),1)]),_:2},1024)):F("",!0)]),_:1}),a(c,{prop:"moneyOffId",label:"\u6EE1\u51CF\u6D3B\u52A8",width:"100"},{default:s(({row:b})=>[b.moneyOffId!==""?(h(),k(u,{key:0,effect:"dark"},{default:s(()=>[g(D(l.moneyOffMapping.map[b.moneyOffId]),1)]),_:2},1024)):F("",!0)]),_:1}),a(c,{prop:"price",label:"\u6D3B\u52A8\u4EF7",width:"150",sortable:""}),a(c,{prop:"productCoupon",label:"\u5546\u54C1\u5238",width:"120"}),a(c,{prop:"cutPrice",label:"\u62CD\u4E0B\u7ACB\u51CF",width:"120"}),a(c,{prop:"deposit",label:"\u5B9A\u91D1",width:"120"}),a(c,{prop:"balance",label:"\u5230\u624B\u4EF7",width:"120"}),a(c,{prop:"remark",label:"\u5907\u6CE8"}),a(c,{fixed:"right",label:"\u64CD\u4F5C",width:"120"},{default:s(({row:b,$index:w})=>[a(i,{link:"",type:"primary",size:"small",onClick:I(S=>r.handleAddOrUpdate({row:b,index:w}),["prevent"])},{default:s(()=>[g(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(i,{link:"",type:"primary",size:"small",onClick:I(S=>l.cart.deleteProduct(w),["prevent"])},{default:s(()=>[g(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data","width","height","onSelectionChange"])]),_:1})]),a(C,{ref:"add"},null,512)])}const Pe=M(Ve,[["render",Se],["__scopeId","data-v-63bfc428"]]),Ne={data(){return{dialogVisible:!1,formModel:{},rules:be}},setup(){const{cart:n}=T();return{cart:n}},methods:{initDialog({row:n,index:e}={}){this.dialogVisible=!0,this.isAdd=!n,this.formModel=E.exports.cloneDeep(n||ge),this.index=e},closeDialog(){this.dialogVisible=!1},async handleConfirm(){await this.$refs.form.validate((n,e)=>{n?(this.isAdd?this.cart.addBrand(this.formModel):this.cart.updateBrand(this.formModel,this.index),this.closeDialog()):console.log("error submit!",e)})}}},Ue={class:"dialog-footer"};function De(n,e,t,l,o,r){const i=p("el-input"),d=p("el-form-item"),c=p("el-form"),u=p("el-button"),_=p("el-dialog");return h(),k(_,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[2]||(e[2]=y=>o.dialogVisible=y),title:"\u65B0\u589E",width:"30%","destroy-on-close":"",center:""},{footer:s(()=>[v("span",Ue,[a(u,{onClick:r.closeDialog},{default:s(()=>[g("\u53D6\u6D88")]),_:1},8,["onClick"]),a(u,{type:"primary",onClick:r.handleConfirm},{default:s(()=>[g(" \u786E\u5B9A ")]),_:1},8,["onClick"])])]),default:s(()=>[a(c,{ref:"form","label-width":"100px",model:o.formModel,rules:o.rules},{default:s(()=>[a(d,{label:"\u54C1\u724C\u540D\u79F0",prop:"brandName"},{default:s(()=>[a(i,{modelValue:o.formModel.brandName,"onUpdate:modelValue":e[0]||(e[0]=y=>o.formModel.brandName=y)},null,8,["modelValue"])]),_:1}),a(d,{label:"\u5907\u6CE8",prop:"remark"},{default:s(()=>[a(i,{modelValue:o.formModel.remark,"onUpdate:modelValue":e[1]||(e[1]=y=>o.formModel.remark=y),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}const Ie=M(Ne,[["render",De]]);const Be={components:{AddBrand:Ie},data(){return{columns:[]}},setup(){const{cart:n}=T(),{brandList:e}=R(n);return{cart:n,brandList:e}},methods:{handleAddOrUpdate(n){this.$refs.add.initDialog(n)},handleBeforeUpload(n){const e=new FileReader;e.readAsText(n),e.onload=t=>{const l=JSON.parse(t.target.result);this.cart.importBrandList(l)}}}},Re={class:"cart__wrapper"},Ae={style:{display:"flex"}},je={class:"cart-table__wrapper"};function qe(n,e,t,l,o,r){const i=p("el-button"),d=p("el-upload"),c=p("el-table-column"),u=p("el-table"),_=p("el-auto-resizer"),y=p("add-brand");return h(),O("div",Re,[v("div",Ae,[a(i,{type:"primary",onClick:r.handleAddOrUpdate},{default:s(()=>[g("\u65B0\u589E\u54C1\u724C")]),_:1},8,["onClick"]),a(i,{type:"primary",onClick:l.cart.saveBrandList},{default:s(()=>[g("\u5BFC\u51FA")]),_:1},8,["onClick"]),a(d,{accept:".json","show-file-list":!1,action:"#",beforeUpload:r.handleBeforeUpload},{trigger:s(()=>[a(i,null,{default:s(()=>[g(" \u5BFC\u5165 ")]),_:1})]),_:1},8,["accept","beforeUpload"])]),v("div",je,[a(_,null,{default:s(({height:C,width:m})=>[a(u,{data:l.brandList,width:m,height:C},{default:s(()=>[a(c,{prop:"id",label:"ID",width:"120"}),a(c,{prop:"brandName",label:"\u54C1\u724C\u540D",width:"150"}),a(c,{prop:"remark",label:"\u5907\u6CE8"}),a(c,{label:"\u64CD\u4F5C",width:"120"},{default:s(({row:f,$index:b})=>[a(i,{link:"",type:"primary",size:"small",onClick:I(w=>r.handleAddOrUpdate({row:f,index:b}),["prevent"])},{default:s(()=>[g(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(i,{link:"",type:"primary",size:"small",onClick:I(w=>l.cart.deleteBrand(b),["prevent"])},{default:s(()=>[g(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data","width","height"])]),_:1})]),a(y,{ref:"add"},null,512)])}const Ee=M(Be,[["render",qe],["__scopeId","data-v-31110d11"]]);const ze={data(){return{}},props:{total:{type:Number,default:0}},setup(n,e){const{proxy:t}=$(),l=j({calc:!0,id:0,precision:0}),o=j({calc:!1,type:""}),r=j({calc:!1,threshold:1e3,precision:50}),{cart:i}=T(),{productList:d,productSelectionList:c}=R(i),u=N(()=>c.value.length||d.value.length);return{cart:i,filterProdLength:u,handleCalcMoneyOff:()=>{if(u.value>24){t.$msg.error("\u9009\u62E9\u6570\u636E\u8FC7\u591A\uFF01");return}e.emit("calc",{categoryCoupon:o,moneyOff:l,balance:r})},categoryCoupon:o,moneyOff:l,balance:r}}},Q=n=>(K("data-v-edbeb4d0"),n=n(),W(),n),Fe={class:"calc-btn__wrapper"},Je=Q(()=>v("div",{class:"ml10"},"\u6EE1\u51CF\u7C7B\u578B\uFF1A",-1)),Ke=Q(()=>v("div",{class:"ml10"},"\u7B5B\u9009\u7CBE\u5EA6\uFF1A",-1)),We={class:"ml10"};function He(n,e,t,l,o,r){const i=p("el-option"),d=p("el-select"),c=p("el-input"),u=p("el-form-item"),_=p("el-checkbox"),y=p("el-form"),C=p("el-button");return h(),O("div",Fe,[a(y,{ref:"form","label-width":"100px",inline:!0,"label-suffix":":"},{default:s(()=>[a(u,{label:"\u8BA1\u7B97\u6EE1\u51CF"},{default:s(()=>[Je,a(d,{modelValue:l.moneyOff.id,"onUpdate:modelValue":e[0]||(e[0]=m=>l.moneyOff.id=m),disabled:!l.moneyOff.calc,style:{width:"100px"}},{default:s(()=>[(h(!0),O(L,null,x(l.cart.moneyOffMapping.options,m=>(h(),k(i,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),Ke,a(c,{modelValue:l.moneyOff.precision,"onUpdate:modelValue":e[1]||(e[1]=m=>l.moneyOff.precision=m),modelModifiers:{number:!0},disabled:!l.moneyOff.calc,style:{width:"100px"}},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"\u54C1\u7C7B\u5238"},{default:s(()=>[a(d,{class:"ml10",modelValue:l.categoryCoupon.type,"onUpdate:modelValue":e[2]||(e[2]=m=>l.categoryCoupon.type=m),clearable:"",style:{width:"100px"}},{default:s(()=>[(h(!0),O(L,null,x(l.cart.categoryCouponMapping.options,m=>(h(),k(i,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"\u4F7F\u7528\u6D88\u8D39\u5238"},{default:s(()=>[a(_,{modelValue:l.balance.calc,"onUpdate:modelValue":e[3]||(e[3]=m=>l.balance.calc=m)},null,8,["modelValue"]),a(d,{class:"ml10",modelValue:l.balance.threshold,"onUpdate:modelValue":e[4]||(e[4]=m=>l.balance.threshold=m),clearable:"",style:{width:"120px"},disabled:!l.balance.calc},{default:s(()=>[(h(!0),O(L,null,x(l.cart.voncherOptions,m=>(h(),k(i,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),g(" \u7B5B\u9009\u7CBE\u5EA6\uFF1A "),a(c,{modelValue:l.balance.precision,"onUpdate:modelValue":e[5]||(e[5]=m=>l.balance.precision=m),modelModifiers:{number:!0},disabled:!l.balance.calc,style:{width:"100px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1},512),v("div",null,"\u9009\u4E2D"+D(l.filterProdLength)+"\u4E2A",1),a(C,{class:"ml10",onClick:l.handleCalcMoneyOff},{default:s(()=>[g("\u67E5\u8BE2")]),_:1},8,["onClick"]),v("div",We,"\u5171"+D(t.total)+"\u6761",1)])}const Qe=M(ze,[["render",He],["__scopeId","data-v-edbeb4d0"]]);const Ge={components:{FilterCondition:Qe},data(){return{columns:[],orders:[]}},setup(){const{cart:n}=T(),{productList:e,productSelectionList:t}=R(n),l=U(!1),o=U(""),r=U([]),i=()=>{l.value=!0,r.value=[],o.value="\u8BA1\u7B97\u4E2D"},d=()=>{l.value=!1,o.value="",r.value.length===0&&B.info("\u65E0\u7ED3\u679C\uFF0C\u8BF7\u4FEE\u6539\u7B5B\u9009\u6761\u4EF6!")},c=_=>new H({productList:P(t.value.length?t.value:e.value),calcCon:P(_),moneyOffConfig:P(n.moneyOffMapping.config),categoryCouponConfig:P(n.categoryCouponMapping.config)});return{productList:e,productSelectionList:t,loading:l,loadingMsg:o,dataSource:r,handleCalcMoneyOff:_=>{i(),setTimeout(async()=>{const y=c(_);r.value=await y.calc(),d()},50)}}},methods:{generateColumns(){const n=[{key:"products",title:"\u8BA2\u5355\u5546\u54C1",width:800},{key:"total",title:"\u603B\u8BA1",width:100},{key:"moneyOffPriceTotal",title:"\u6EE1\u51CF\u603B\u8BA1",width:100},{key:"moneyOffDiff",title:"\u6EE1\u51CF\u5DEE\u503C",width:100},{key:"balance",title:"\u5B9E\u4ED8",width:100},{key:"balanceDiff",title:"\u5B9E\u4ED8\u95E8\u69DB\u5DEE\u503C",width:100},{key:"categoryCoupon",title:"\u4F7F\u7528\u54C1\u7C7B\u5238",width:100}];this.columns=n.map(e=>{const{key:t}=e;return Object.assign(e,{props:t,dataKey:t})})}},created(){this.generateColumns()}},Xe=["element-loading-text"],Ye={class:"sln__wrapper"};function Ze(n,e,t,l,o,r){const i=p("filter-condition"),d=p("el-table-v2"),c=p("el-auto-resizer"),u=ee("loading");return oe((h(),O("div",{class:"result__wrapper","element-loading-text":l.loadingMsg},[a(i,{total:l.dataSource.length,onCalc:l.handleCalcMoneyOff},null,8,["total","onCalc"]),v("div",Ye,[a(c,null,{default:s(({height:_,width:y})=>[a(d,{columns:o.columns,data:l.dataSource,width:y,height:_},null,8,["columns","data","width","height"])]),_:1})])],8,Xe)),[[u,l.loading]])}const $e=M(Ge,[["render",Ze],["__scopeId","data-v-eb38d4ab"]]);const eo={data(){return{activeName:"cart"}},components:{ShoppingCart:Pe,MoneyOffResult:$e,BrandList:Ee},methods:{}},oo={class:"page_wrapper"},to={class:"main__wrapper"};function lo(n,e,t,l,o,r){const i=p("shopping-cart"),d=p("el-tab-pane"),c=p("brand-list"),u=p("el-tabs"),_=p("money-off-result");return h(),O("div",oo,[v("div",to,[a(u,{modelValue:o.activeName,"onUpdate:modelValue":e[0]||(e[0]=y=>o.activeName=y)},{default:s(()=>[a(d,{label:"\u8D2D\u7269\u8F66",name:"cart"},{default:s(()=>[a(i)]),_:1}),a(d,{label:"\u54C1\u724C",name:"brand"},{default:s(()=>[a(c)]),_:1})]),_:1},8,["modelValue"])]),a(_,{class:"money-off-wrapper"})])}const no=M(eo,[["render",lo]]),ao=te({history:le("/moneyoffcalc/"),routes:[{path:"/",name:"home",component:no}]});const A=ne(me),G=ae();G.use(re);A.use(G);A.use(ao).use(ce);A.config.globalProperties.$msg=B;A.mount("#app");
