var X=Object.defineProperty;var Y=(n,e,o)=>e in n?X(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var z=(n,e,o)=>(Y(n,typeof e!="symbol"?e+"":e,o),o);import{af as f,l as h,m as O,p as v,W as a,F as L,av as K,aw as W,ax as Z,P as k,Q as s,U as g,a5 as x,ay as I,e as P,V as N,T as F,_ as U,$ as A,c as $,a as j,ai as ee,R as te,ab as S,az as oe,aA as le,as as ne,aB as ae,aC as re}from"./vue.52e69934.js";import{a as se,l as q}from"./utils.11921c2f.js";import{E as D,a as ie,i as ce}from"./ele.49b9e069.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function o(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerpolicy&&(r.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?r.credentials="include":t.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(t){if(t.ep)return;t.ep=!0;const r=o(t);fetch(t.href,r)}})();const M=(n,e)=>{const o=n.__vccOpts||n;for(const[l,t]of e)o[l]=t;return o},de={},ue=n=>(K("data-v-a5ac23ae"),n=n(),W(),n),pe=ue(()=>v("header",null," \u5929\u732B\u6EE1\u51CF\u8BA1\u7B97 ",-1));function fe(n,e){const o=f("RouterView");return h(),O(L,null,[pe,v("main",null,[a(o)])],64)}const me=M(de,[["render",fe],["__scopeId","data-v-a5ac23ae"]]),_e=()=>se("1234567890abcdefghijklmnopqrstuvwxyz",8)(8),ye=function(n){console.time("subsets");const e=[],o=n.length;for(let l=0;l<1<<o;++l){const t=[];for(let r=0;r<o;++r)l&1<<r&&t.push(n[r]);t.length&&e.push(t)}return console.log(e.length),console.timeEnd("subsets"),e},J=(n,e,o="")=>{const l=new Blob([n],{type:`application/${e}`});if(o=`${o}.${e}`,window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(l,o);else{const t=document.createElement("a"),r=document.querySelector("body");t.href=window.URL.createObjectURL(l),t.download=o,t.style.display="none",r.appendChild(t),t.click(),r.removeChild(t),window.URL.revokeObjectURL(t.href)}},V=({array:n=[],map:e={},key:o="id",value:l="item"})=>(n.forEach(t=>{const r=o?t[o]:t,i=l==="item"?t:t[l];e[r]=i}),e);class E{constructor(e={}){var o;Object.assign(this,e),this.map=(o=this.map)!=null?o:{},this.options=this.getOptions()}getOptions(){const e=[];if(Object.keys(this.map).length)for(let o in this.map){/^[0-9]*$/.test(o)&&(o=+o);let l={label:this.map[o],value:o};e.push(l)}return e}}const he=Z("cart",{state:()=>({productList:[],productSelectionList:[],brandList:[],categoryCouponList:[{id:0,couponName:"\u7F8E\u5986\u60CA\u559C\u5238",couponType:"makeup",threshold:1200,off:110},{id:1,couponName:"\u7CBE\u81F4\u751F\u6D3B\u5238",couponType:"life",threshold:200,off:15}],moneyOffList:[{id:0,label:"300-50",threshold:300,off:50}],productNextId:0,voncherOptions:[{label:"1000-50",value:1e3},{label:"3800-300",value:3800},{label:"6800-300",value:6800}]}),getters:{brandMapping:n=>new E({map:V({array:n.brandList,key:"id",value:"brandName"})}),categoryCouponMapping:n=>new E({map:V({array:n.categoryCouponList,key:"couponType",value:"couponName"}),config:V({array:n.categoryCouponList,key:"couponType",value:"item"})}),moneyOffMapping:n=>new E({map:V({array:n.moneyOffList,key:"id",value:"label"}),config:V({array:n.moneyOffList,key:"id",value:"item"})})},actions:{updateProductSelectionList(n){this.productSelectionList=n},addProduct(n){const e={...n,id:this.productNextId},{productName:o}=e;this.productList.find(t=>t.productName===o)?D.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):(this.productList.push(e),this.productNextId=this.productNextId+1)},updateProduct(n,e){this.productList.splice(e,1,n)},deleteProduct(n){this.productList.splice(n,1)},saveProductList(){J(JSON.stringify(this.productList,null,2),"json","shoppingCart")},importProductList(n){this.productList=n,this.productNextId=q.exports.last(n.sort((e,o)=>e.id-o.id)).id+1},addBrand(n){const e={...n,id:_e()},{brandName:o}=e;this.brandList.find(t=>t.brandName===o)?D.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):this.brandList.push(e)},updateBrand(n,e){this.brandList.splice(e,1,n)},deleteBrand(n){this.brandList.splice(n,1)},saveBrandList(){J(JSON.stringify(this.brandList,null,2),"json","brandList")},importBrandList(n){this.brandList=n}},persist:!0});function T(){return{cart:he()}}const ge={brandName:"",remark:""},be={brandName:[{required:!0,message:"\u8BF7\u8F93\u5165\u54C1\u724C\u540D\u79F0",trigger:"blur"}]},Ce={productName:"",brandId:null,unitPrice:0,quantity:1,price:0,categoryCouponType:null,moneyOffId:0,productCoupon:0,cutPrice:0,deposit:0,remark:""},ve={productName:[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",trigger:"blur"}],brandId:[{required:!0,message:"\u8BF7\u9009\u62E9\u54C1\u724C",trigger:"change"}],unitPrice:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],quantity:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],productCoupon:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],cutPrice:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],deposit:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}]},Oe={data(){return{dialogVisible:!1,formModel:{},rules:ve}},setup(){const{cart:n}=T(),e=n.categoryCouponMapping.options,o=n.moneyOffMapping.options;return{cart:n,categoryCouponOptions:e,moneyOffOptions:o}},methods:{initDialog({row:n,index:e}={}){this.dialogVisible=!0,this.isAdd=!n,this.formModel=q.exports.cloneDeep(n||Ce),this.index=e},closeDialog(){this.dialogVisible=!1},async handleConfirm(){await this.$refs.form.validate((n,e)=>{if(n){const{unitPrice:o,quantity:l}=this.formModel;Object.assign(this.formModel,{price:o*1e4*l/1e4}),this.isAdd?this.cart.addProduct(this.formModel):this.cart.updateProduct(this.formModel,this.index),this.closeDialog()}else console.log("error submit!",e)})}}},ke={class:"dialog-footer"};function we(n,e,o,l,t,r){const i=f("el-input"),u=f("el-form-item"),c=f("el-option"),d=f("el-select"),m=f("el-input-number"),y=f("el-form"),C=f("el-button"),_=f("el-dialog");return h(),k(_,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[10]||(e[10]=p=>t.dialogVisible=p),title:"\u65B0\u589E",width:"30%","destroy-on-close":"",center:""},{footer:s(()=>[v("span",ke,[a(C,{onClick:r.closeDialog},{default:s(()=>[g("\u53D6\u6D88")]),_:1},8,["onClick"]),a(C,{type:"primary",onClick:r.handleConfirm},{default:s(()=>[g(" \u786E\u5B9A ")]),_:1},8,["onClick"])])]),default:s(()=>[a(y,{ref:"form","label-width":"100px",model:t.formModel,rules:t.rules},{default:s(()=>[a(u,{label:"\u5546\u54C1\u540D\u79F0",prop:"productName"},{default:s(()=>[a(i,{modelValue:t.formModel.productName,"onUpdate:modelValue":e[0]||(e[0]=p=>t.formModel.productName=p)},null,8,["modelValue"])]),_:1}),a(u,{label:"\u54C1\u724C",prop:"brandId"},{default:s(()=>[a(d,{modelValue:t.formModel.brandId,"onUpdate:modelValue":e[1]||(e[1]=p=>t.formModel.brandId=p),placeholder:"\u8BF7\u9009\u62E9\u54C1\u724C"},{default:s(()=>[(h(!0),O(L,null,x(l.cart.brandMapping.options,p=>(h(),k(c,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"\u5355\u4EF7",prop:"unitPrice"},{default:s(()=>[a(m,{modelValue:t.formModel.unitPrice,"onUpdate:modelValue":e[2]||(e[2]=p=>t.formModel.unitPrice=p),step:.01},null,8,["modelValue","step"])]),_:1}),a(u,{label:"\u6570\u91CF",prop:"quantity"},{default:s(()=>[a(m,{min:1,modelValue:t.formModel.quantity,"onUpdate:modelValue":e[3]||(e[3]=p=>t.formModel.quantity=p)},null,8,["modelValue"])]),_:1}),a(u,{label:"\u54C1\u7C7B\u5238\u7C7B\u578B",prop:"categoryCouponType"},{default:s(()=>[a(d,{modelValue:t.formModel.categoryCouponType,"onUpdate:modelValue":e[4]||(e[4]=p=>t.formModel.categoryCouponType=p),placeholder:"\u8BF7\u9009\u62E9\u54C1\u7C7B\u5238\u7C7B\u578B"},{default:s(()=>[(h(!0),O(L,null,x(l.categoryCouponOptions,p=>(h(),k(c,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"\u6EE1\u51CF\u7C7B\u578B",prop:"moneyOffId"},{default:s(()=>[a(d,{modelValue:t.formModel.moneyOffId,"onUpdate:modelValue":e[5]||(e[5]=p=>t.formModel.moneyOffId=p),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6EE1\u51CF\u7C7B\u578B"},{default:s(()=>[(h(!0),O(L,null,x(l.moneyOffOptions,p=>(h(),k(c,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"\u5546\u54C1\u5238\u91D1\u989D",prop:"productCoupon"},{default:s(()=>[a(i,{modelValue:t.formModel.productCoupon,"onUpdate:modelValue":e[6]||(e[6]=p=>t.formModel.productCoupon=p),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(u,{label:"\u62CD\u4E0B\u7ACB\u51CF\u91D1\u989D",prop:"cutPrice"},{default:s(()=>[a(i,{modelValue:t.formModel.cutPrice,"onUpdate:modelValue":e[7]||(e[7]=p=>t.formModel.cutPrice=p),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(u,{label:"\u5B9A\u91D1",prop:"deposit"},{default:s(()=>[a(i,{modelValue:t.formModel.deposit,"onUpdate:modelValue":e[8]||(e[8]=p=>t.formModel.deposit=p),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(u,{label:"\u5907\u6CE8",prop:"remark"},{default:s(()=>[a(i,{type:"textarea",modelValue:t.formModel.remark,"onUpdate:modelValue":e[9]||(e[9]=p=>t.formModel.remark=p)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}const Me=M(Oe,[["render",we]]);class H{constructor({productList:e=[],calcCon:o={},moneyOffConfig:l,categoryCouponConfig:t}){z(this,"getOrders",(e=[])=>{const{threshold:o,off:l}=this.moneyOffSlnConfig,t=V({array:this.productList,key:"id",value:"item"});return new Promise(r=>{const i=[];for(let u=0;u<e.length;u++){const c=e[u],d=c.map(R=>t[R]),m=this.getStatictics(d),{moneyOffPriceTotal:y,categoryCouponCalc:C,depositTotal:_}=m,p=this.getCategoryCouponSln(C),b=Object.assign(c,{order:d,...m,moneyOffTotal:Math.floor(y/o)*l,moneyOffDiff:Math.round(y%o*1e4)/1e4,...p}),w=this.getBalance(b);Object.assign(b,{balance:w,cutDeposit:w-_}),b.moneyOffDiff<=this.calcCon.moneyOff.precision&&i.push(b)}r(i)})});Object.assign(this,{productList:e,calcCon:o,categoryCouponConfig:t}),this.moneyOffSlnConfig=l[o.moneyOff.id],this.productMap=V({array:this.productList,key:"id",value:"item"})}async calc(){console.time("calc");const e=this.getSubsets();console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----");const o=await this.getResult(e);return console.log("----\u7ED3\u679C\u8BA1\u7B97\u5B8C\u6210-----"),console.timeEnd("calc"),Promise.resolve(o)}async total(){return this.getOrder(this.productList)}getSubsets(){const e=[],o=this.productList.length;for(let l=0;l<1<<o;++l){const t=[];for(let r=0;r<o;++r)l&1<<r&&t.push(this.productList[r]);if(t.length){const r=this.getOrder(t);r&&e.push(r)}}return e}getOrder(e){const{threshold:o,off:l}=this.moneyOffSlnConfig,t=this.getStatictics(e),{moneyOffPriceTotal:r,categoryCouponCalc:i,depositTotal:u}=t,c=this.getCategoryCouponSln(i),d={order:e,...t,moneyOffTotal:Math.floor(r/o)*l,moneyOffDiff:Math.round(r%o),...c},m=this.getBalance(d);return Object.assign(d,{balance:m,cutDeposit:m-u}),d}getStatictics(e){return e.reduce((o,l)=>{const{moneyOffId:t,price:r,categoryCouponType:i,deposit:u,cutPrice:c,productCoupon:d}=l;return o.total=o.total+r,o.depositTotal=o.depositTotal+u,o.cutPriceTotal=o.cutPriceTotal+c,o.productCouponTotal=o.productCouponTotal+d,t===this.moneyOffSlnConfig.id&&(o.moneyOffPriceTotal=o.moneyOffPriceTotal+r),i&&(o.categoryCouponCalc[i]=o.categoryCouponCalc[i]+r),o},{total:0,moneyOffPriceTotal:0,depositTotal:0,cutPriceTotal:0,productCouponTotal:0,categoryCouponCalc:{life:0,makeup:0}})}getCategoryCouponSln(e){const o={categoryCoupon:[],categoryCouponTotal:0};return Object.entries(e).forEach(([l,t])=>{const{threshold:r}=this.categoryCouponConfig[l];t>=r&&(o.categoryCoupon.push(l),o.categoryCouponTotal=o.categoryCouponTotal+this.categoryCouponConfig[l].off)}),o}getBalance(e){const{total:o,moneyOffTotal:l,categoryCouponTotal:t,productCouponTotal:r,cutPriceTotal:i}=e,u=o-l-t-r-i;return Math.round(u*1e4)/1e4}async getResult(e){const o=[];for(let l=0;l<e.length;l++){const t=e[l],{order:r}=t;t.products=r.map(m=>m.productName).join("|");const{moneyOff:i,balance:u,categoryCoupon:c}=this.calcCon;let d=null;if(t.moneyOffDiff<=i.precision&&(d=t),d&&c.type.length&&(d=null,c.type.length>1?c.type.length===t.categoryCoupon.length&&(d=t):c.type.forEach(m=>{t.categoryCoupon.includes(m)&&(d=t)})),d&&u.calc){d=null;const{threshold:m,precision:y}=u;t.balance>=m&&t.balance-m<=y&&(t.balanceDiff=t.balance-m,d=t)}d&&o.push(d)}return console.log(o),this.calcCon.balance.calc?o.sort((l,t)=>l.balanceDiff-t.balanceDiff):o.sort((l,t)=>l.moneyOffDiff-t.moneyOffDiff),o}async _getSubsets(){const e=this.getIdSubsets();console.log("----\u5546\u54C1ID\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210------");const o=await this.getOrders(e);return console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----"),o}getIdSubsets(){return ye(this.productList.map(e=>e.id))}}const Ve={components:{AddProduct:Me},data(){return{columns:[]}},setup(){const{cart:n}=T(),{productList:e,brandList:o}=I(n),l=P(()=>n.categoryCouponMapping),t=P(()=>n.moneyOffMapping),r=c=>{n.updateProductSelectionList(c)},i=async()=>{const d=await new H({productList:e.value,calcCon:{moneyOff:{id:0}},moneyOffConfig:t.value.config,categoryCouponConfig:l.value.config}).total(),{balance:m,depositTotal:y,cutDeposit:C}=d;ie.alert(`\u5B9E\u4ED8\uFF1A${m} \u5DF2\u4ED8\u5B9A\u91D1\uFF1A${y}  \u5C3E\u6B3E\u5B9E\u4ED8\uFF1A${C}`,"\u8D2D\u7269\u8F66\u603B\u5B9E\u4ED8\u6B3E")};return{filterTableData:P(()=>e.value.map(c=>{const{price:d,moneyOffId:m,productCoupon:y,cutPrice:C}=c,_=d-y-C;let p=0;if(m!==""){const{threshold:b,off:w}=t.value.config[m]||{};p=Math.floor(d/b)*w}return Object.assign(c,{balance:_-p})})),cart:n,brandList:o,categoryCouponMapping:l,moneyOffMapping:t,handleSelectionChange:r,handleCalcTotal:i}},created(){this.generateColumns()},methods:{handleAddOrUpdate(n){this.$refs.add.initDialog(n)},handleBeforeUpload(n){const e=new FileReader;e.readAsText(n),e.onload=o=>{const l=JSON.parse(o.target.result);this.cart.importProductList(l)}},generateColumns(){const n=[{key:"id",title:"ID",width:50},{key:"productName",title:"\u5546\u54C1\u540D",width:200},{key:"price",title:"\u6D3B\u52A8\u4EF7",width:100,sortable:!0},{key:"balance",title:"\u5B9E\u4ED8",width:100},{key:"categoryCouponType",title:"\u54C1\u7C7B\u5238",width:100},{key:"moneyOffId",title:"\u6EE1\u51CF\u6D3B\u52A8",width:100},{key:"productCoupon",title:"\u5546\u54C1\u5238",width:100},{key:"cutPrice",title:"\u62CD\u4E0B\u7ACB\u51CF",width:100},{key:"deposit",title:"\u5B9A\u91D1",width:100},{key:"operations",type:"oper",title:"\u64CD\u4F5C",width:100}];this.columns=n.map(e=>{const{key:o,type:l}=e;return Object.assign(e,{props:o,dataKey:l?void 0:o})})}}},Le={class:"cart__wrapper"},xe={style:{display:"flex",gap:"10px"}},Te={class:"cart-table__wrapper"};function Se(n,e,o,l,t,r){const i=f("el-button"),u=f("el-upload"),c=f("el-table-column"),d=f("el-tag"),m=f("el-table"),y=f("el-auto-resizer"),C=f("add-product");return h(),O("div",Le,[v("div",xe,[a(i,{type:"primary",disabled:!l.brandList.length,onClick:r.handleAddOrUpdate},{default:s(()=>[g("\u65B0\u589E\u5546\u54C1")]),_:1},8,["disabled","onClick"]),a(i,{type:"primary",onClick:l.cart.saveProductList},{default:s(()=>[g("\u5BFC\u51FA")]),_:1},8,["onClick"]),a(u,{accept:".json","show-file-list":!1,action:"#",beforeUpload:r.handleBeforeUpload},{trigger:s(()=>[a(i,null,{default:s(()=>[g(" \u5BFC\u5165 ")]),_:1})]),_:1},8,["accept","beforeUpload"]),a(i,{class:"ml10",onClick:l.handleCalcTotal},{default:s(()=>[g("\u603B\u5B9E\u4ED8\u6B3E")]),_:1},8,["onClick"])]),v("div",Te,[a(y,null,{default:s(({height:_,width:p})=>[a(m,{data:l.filterTableData,width:p,height:_,ref:"table",onSelectionChange:l.handleSelectionChange},{default:s(()=>[a(c,{type:"selection",width:"55"}),a(c,{prop:"id",label:"ID",width:"50"}),a(c,{prop:"productName",label:"\u5546\u54C1\u540D",width:"180"}),a(c,{prop:"categoryCouponType",label:"\u54C1\u7C7B\u5238",width:"120",sortable:""},{default:s(({row:b})=>[b.categoryCouponType?(h(),k(d,{key:0,effect:"plain"},{default:s(()=>[g(N(l.categoryCouponMapping.map[b.categoryCouponType]),1)]),_:2},1024)):F("",!0)]),_:1}),a(c,{prop:"moneyOffId",label:"\u6EE1\u51CF\u6D3B\u52A8",width:"100"},{default:s(({row:b})=>[b.moneyOffId!==""?(h(),k(d,{key:0,effect:"dark"},{default:s(()=>[g(N(l.moneyOffMapping.map[b.moneyOffId]),1)]),_:2},1024)):F("",!0)]),_:1}),a(c,{prop:"price",label:"\u6D3B\u52A8\u4EF7",width:"150",sortable:""}),a(c,{prop:"productCoupon",label:"\u5546\u54C1\u5238",width:"120"}),a(c,{prop:"cutPrice",label:"\u62CD\u4E0B\u7ACB\u51CF",width:"120"}),a(c,{prop:"deposit",label:"\u5B9A\u91D1",width:"120"}),a(c,{prop:"balance",label:"\u5230\u624B\u4EF7",width:"120"}),a(c,{prop:"remark",label:"\u5907\u6CE8"}),a(c,{fixed:"right",label:"\u64CD\u4F5C",width:"120"},{default:s(({row:b,$index:w})=>[a(i,{link:"",type:"primary",size:"small",onClick:U(R=>r.handleAddOrUpdate({row:b,index:w}),["prevent"])},{default:s(()=>[g(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(i,{link:"",type:"primary",size:"small",onClick:U(R=>l.cart.deleteProduct(w),["prevent"])},{default:s(()=>[g(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data","width","height","onSelectionChange"])]),_:1})]),a(C,{ref:"add"},null,512)])}const Pe=M(Ve,[["render",Se],["__scopeId","data-v-95039ac8"]]),Ne={data(){return{dialogVisible:!1,formModel:{},rules:be}},setup(){const{cart:n}=T();return{cart:n}},methods:{initDialog({row:n,index:e}={}){this.dialogVisible=!0,this.isAdd=!n,this.formModel=q.exports.cloneDeep(n||ge),this.index=e},closeDialog(){this.dialogVisible=!1},async handleConfirm(){await this.$refs.form.validate((n,e)=>{n?(this.isAdd?this.cart.addBrand(this.formModel):this.cart.updateBrand(this.formModel,this.index),this.closeDialog()):console.log("error submit!",e)})}}},Ue={class:"dialog-footer"};function De(n,e,o,l,t,r){const i=f("el-input"),u=f("el-form-item"),c=f("el-form"),d=f("el-button"),m=f("el-dialog");return h(),k(m,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[2]||(e[2]=y=>t.dialogVisible=y),title:"\u65B0\u589E",width:"30%","destroy-on-close":"",center:""},{footer:s(()=>[v("span",Ue,[a(d,{onClick:r.closeDialog},{default:s(()=>[g("\u53D6\u6D88")]),_:1},8,["onClick"]),a(d,{type:"primary",onClick:r.handleConfirm},{default:s(()=>[g(" \u786E\u5B9A ")]),_:1},8,["onClick"])])]),default:s(()=>[a(c,{ref:"form","label-width":"100px",model:t.formModel,rules:t.rules},{default:s(()=>[a(u,{label:"\u54C1\u724C\u540D\u79F0",prop:"brandName"},{default:s(()=>[a(i,{modelValue:t.formModel.brandName,"onUpdate:modelValue":e[0]||(e[0]=y=>t.formModel.brandName=y)},null,8,["modelValue"])]),_:1}),a(u,{label:"\u5907\u6CE8",prop:"remark"},{default:s(()=>[a(i,{modelValue:t.formModel.remark,"onUpdate:modelValue":e[1]||(e[1]=y=>t.formModel.remark=y),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}const Ie=M(Ne,[["render",De]]);const Be={components:{AddBrand:Ie},data(){return{columns:[]}},setup(){const{cart:n}=T(),{brandList:e}=I(n);return{cart:n,brandList:e}},methods:{handleAddOrUpdate(n){this.$refs.add.initDialog(n)},handleBeforeUpload(n){const e=new FileReader;e.readAsText(n),e.onload=o=>{const l=JSON.parse(o.target.result);this.cart.importBrandList(l)}}}},Re={class:"cart__wrapper"},Ae={style:{display:"flex"}},je={class:"cart-table__wrapper"};function Ee(n,e,o,l,t,r){const i=f("el-button"),u=f("el-upload"),c=f("el-table-column"),d=f("el-table"),m=f("el-auto-resizer"),y=f("add-brand");return h(),O("div",Re,[v("div",Ae,[a(i,{type:"primary",onClick:r.handleAddOrUpdate},{default:s(()=>[g("\u65B0\u589E\u54C1\u724C")]),_:1},8,["onClick"]),a(i,{type:"primary",onClick:l.cart.saveBrandList},{default:s(()=>[g("\u5BFC\u51FA")]),_:1},8,["onClick"]),a(u,{accept:".json","show-file-list":!1,action:"#",beforeUpload:r.handleBeforeUpload},{trigger:s(()=>[a(i,null,{default:s(()=>[g(" \u5BFC\u5165 ")]),_:1})]),_:1},8,["accept","beforeUpload"])]),v("div",je,[a(m,null,{default:s(({height:C,width:_})=>[a(d,{data:l.brandList,width:_,height:C},{default:s(()=>[a(c,{prop:"id",label:"ID",width:"120"}),a(c,{prop:"brandName",label:"\u54C1\u724C\u540D",width:"150"}),a(c,{prop:"remark",label:"\u5907\u6CE8"}),a(c,{label:"\u64CD\u4F5C",width:"120"},{default:s(({row:p,$index:b})=>[a(i,{link:"",type:"primary",size:"small",onClick:U(w=>r.handleAddOrUpdate({row:p,index:b}),["prevent"])},{default:s(()=>[g(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(i,{link:"",type:"primary",size:"small",onClick:U(w=>l.cart.deleteBrand(b),["prevent"])},{default:s(()=>[g(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data","width","height"])]),_:1})]),a(y,{ref:"add"},null,512)])}const qe=M(Be,[["render",Ee],["__scopeId","data-v-31110d11"]]);const ze={data(){return{}},props:{total:{type:Number,default:0}},setup(n,e){const{proxy:o}=$(),l=A({calc:!0,id:0,precision:0}),t=A({calc:!1,type:""}),r=A({calc:!1,threshold:1e3,precision:50}),{cart:i}=T(),{productList:u,productSelectionList:c}=I(i),d=P(()=>c.value.length||u.value.length);return{cart:i,filterProdLength:d,handleCalcMoneyOff:()=>{if(d.value>24){o.$msg.error("\u9009\u62E9\u6570\u636E\u8FC7\u591A\uFF01");return}e.emit("calc",{categoryCoupon:t,moneyOff:l,balance:r})},categoryCoupon:t,moneyOff:l,balance:r}}},Q=n=>(K("data-v-f0bf0fde"),n=n(),W(),n),Fe={class:"calc-btn__wrapper"},Je=Q(()=>v("div",{class:"ml10"},"\u6EE1\u51CF\u7C7B\u578B\uFF1A",-1)),Ke=Q(()=>v("div",{class:"ml10"},"\u7B5B\u9009\u7CBE\u5EA6\uFF1A",-1)),We={class:"ml10"};function He(n,e,o,l,t,r){const i=f("el-option"),u=f("el-select"),c=f("el-input"),d=f("el-form-item"),m=f("el-checkbox"),y=f("el-form"),C=f("el-button");return h(),O("div",Fe,[a(y,{ref:"form","label-width":"100px",inline:!0,"label-suffix":":"},{default:s(()=>[a(d,{label:"\u8BA1\u7B97\u6EE1\u51CF"},{default:s(()=>[Je,a(u,{modelValue:l.moneyOff.id,"onUpdate:modelValue":e[0]||(e[0]=_=>l.moneyOff.id=_),disabled:!l.moneyOff.calc,style:{width:"100px"}},{default:s(()=>[(h(!0),O(L,null,x(l.cart.moneyOffMapping.options,_=>(h(),k(i,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),Ke,a(c,{modelValue:l.moneyOff.precision,"onUpdate:modelValue":e[1]||(e[1]=_=>l.moneyOff.precision=_),modelModifiers:{number:!0},disabled:!l.moneyOff.calc,style:{width:"100px"}},null,8,["modelValue","disabled"])]),_:1}),a(d,{label:"\u54C1\u7C7B\u5238"},{default:s(()=>[a(u,{class:"ml10",modelValue:l.categoryCoupon.type,"onUpdate:modelValue":e[2]||(e[2]=_=>l.categoryCoupon.type=_),clearable:"",multiple:"",style:{width:"250px"}},{default:s(()=>[(h(!0),O(L,null,x(l.cart.categoryCouponMapping.options,_=>(h(),k(i,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u4F7F\u7528\u6D88\u8D39\u5238"},{default:s(()=>[a(m,{modelValue:l.balance.calc,"onUpdate:modelValue":e[3]||(e[3]=_=>l.balance.calc=_)},null,8,["modelValue"]),a(u,{class:"ml10",modelValue:l.balance.threshold,"onUpdate:modelValue":e[4]||(e[4]=_=>l.balance.threshold=_),clearable:"",style:{width:"120px"},disabled:!l.balance.calc},{default:s(()=>[(h(!0),O(L,null,x(l.cart.voncherOptions,_=>(h(),k(i,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),g(" \u7B5B\u9009\u7CBE\u5EA6\uFF1A "),a(c,{modelValue:l.balance.precision,"onUpdate:modelValue":e[5]||(e[5]=_=>l.balance.precision=_),modelModifiers:{number:!0},disabled:!l.balance.calc,style:{width:"100px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1},512),v("div",null,"\u9009\u4E2D"+N(l.filterProdLength)+"\u4E2A",1),a(C,{class:"ml10",onClick:l.handleCalcMoneyOff},{default:s(()=>[g("\u67E5\u8BE2")]),_:1},8,["onClick"]),v("div",We,"\u5171"+N(o.total)+"\u6761",1)])}const Qe=M(ze,[["render",He],["__scopeId","data-v-f0bf0fde"]]);const Ge={components:{FilterCondition:Qe},data(){return{columns:[],orders:[]}},setup(){const{cart:n}=T(),{productList:e,productSelectionList:o}=I(n),l=j(!1),t=j(""),r=j([]),i=()=>{l.value=!0,r.value=[],t.value="\u8BA1\u7B97\u4E2D"},u=()=>{l.value=!1,t.value="",r.value.length===0&&D.info("\u65E0\u7ED3\u679C\uFF0C\u8BF7\u4FEE\u6539\u7B5B\u9009\u6761\u4EF6!")},c=m=>new H({productList:S(o.value.length?o.value:e.value),calcCon:S(m),moneyOffConfig:S(n.moneyOffMapping.config),categoryCouponConfig:S(n.categoryCouponMapping.config)});return{productList:e,productSelectionList:o,loading:l,loadingMsg:t,dataSource:r,handleCalcMoneyOff:m=>{i(),setTimeout(async()=>{const y=c(m);r.value=await y.calc(),u()},50)}}},methods:{generateColumns(){const n=[{key:"products",title:"\u8BA2\u5355\u5546\u54C1",width:800},{key:"total",title:"\u603B\u8BA1",width:100},{key:"moneyOffPriceTotal",title:"\u6EE1\u51CF\u603B\u8BA1",width:100},{key:"moneyOffDiff",title:"\u6EE1\u51CF\u5DEE\u503C",width:100},{key:"balance",title:"\u5B9E\u4ED8",width:100},{key:"balanceDiff",title:"\u5B9E\u4ED8\u95E8\u69DB\u5DEE\u503C",width:100},{key:"categoryCoupon",title:"\u4F7F\u7528\u54C1\u7C7B\u5238",width:100}];this.columns=n.map(e=>{const{key:o}=e;return Object.assign(e,{props:o,dataKey:o})})}},created(){this.generateColumns()}},Xe=["element-loading-text"],Ye={class:"sln__wrapper"};function Ze(n,e,o,l,t,r){const i=f("filter-condition"),u=f("el-table-v2"),c=f("el-auto-resizer"),d=ee("loading");return te((h(),O("div",{class:"result__wrapper","element-loading-text":l.loadingMsg},[a(i,{total:l.dataSource.length,onCalc:l.handleCalcMoneyOff},null,8,["total","onCalc"]),v("div",Ye,[a(c,null,{default:s(({height:m,width:y})=>[a(u,{columns:t.columns,data:l.dataSource,width:y,height:m},null,8,["columns","data","width","height"])]),_:1})])],8,Xe)),[[d,l.loading]])}const $e=M(Ge,[["render",Ze],["__scopeId","data-v-eb38d4ab"]]);const et={data(){return{activeName:"cart"}},components:{ShoppingCart:Pe,MoneyOffResult:$e,BrandList:qe},methods:{}},tt={class:"page_wrapper"},ot={class:"main__wrapper"};function lt(n,e,o,l,t,r){const i=f("shopping-cart"),u=f("el-tab-pane"),c=f("brand-list"),d=f("el-tabs"),m=f("money-off-result");return h(),O("div",tt,[v("div",ot,[a(d,{modelValue:t.activeName,"onUpdate:modelValue":e[0]||(e[0]=y=>t.activeName=y)},{default:s(()=>[a(u,{label:"\u8D2D\u7269\u8F66",name:"cart"},{default:s(()=>[a(i)]),_:1}),a(u,{label:"\u54C1\u724C",name:"brand"},{default:s(()=>[a(c)]),_:1})]),_:1},8,["modelValue"])]),a(m,{class:"money-off-wrapper"})])}const nt=M(et,[["render",lt]]),at=oe({history:le("/moneyoffcalc/"),routes:[{path:"/",name:"home",component:nt}]});const B=ne(me),G=ae();G.use(re);B.use(G);B.use(at).use(ce);B.config.globalProperties.$msg=D;B.mount("#app");
