var Y=Object.defineProperty;var Z=(t,e,o)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var F=(t,e,o)=>(Z(t,typeof e!="symbol"?e+"":e,o),o);import{af as p,l as y,m as v,p as C,W as a,F as V,av as H,aw as Q,ax as $,P as k,Q as i,U as h,a5 as T,ay as N,e as B,V as P,T as J,_ as D,$ as R,c as ee,a as E,ai as te,R as oe,ab as I,d as le,az as ne,aA as ae,as as re,aB as se,aC as ie}from"./vue.52e69934.js";import{a as ce,l as U}from"./utils.11921c2f.js";import{E as j,a as de,i as ue}from"./ele.49b9e069.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerpolicy&&(r.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?r.credentials="include":l.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(l){if(l.ep)return;l.ep=!0;const r=o(l);fetch(l.href,r)}})();const w=(t,e)=>{const o=t.__vccOpts||t;for(const[n,l]of e)o[n]=l;return o},pe={},fe=t=>(H("data-v-d3ff0aed"),t=t(),Q(),t),me=fe(()=>C("header",null," \u5929\u732B\u6EE1\u51CF\u8BA1\u7B97 (\u5148\u65B0\u589E \u54C1\u724C \u518D\u65B0\u589E \u5546\u54C1 \uFF01\uFF01\u6D89\u53CA\u5E97\u94FA\u5238/\u6DD8\u91D1\u5E01/88vip95\u6298\uFF0C\u5B9E\u4ED8\u8BA1\u7B97\u4E0D\u6B63\u786E\uFF01\uFF01\u4E00\u6B21\u8BA1\u7B97\u6700\u591A\u900920\u4E2A\u54C1\uFF01\uFF01) ",-1));function _e(t,e){const o=p("RouterView");return y(),v(V,null,[me,C("main",null,[a(o)])],64)}const ye=w(pe,[["render",_e],["__scopeId","data-v-d3ff0aed"]]),K=()=>ce("1234567890abcdefghijklmnopqrstuvwxyz",8)(8),he=function(t){console.time("subsets");const e=[],o=t.length;for(let n=0;n<1<<o;++n){const l=[];for(let r=0;r<o;++r)n&1<<r&&l.push(t[r]);l.length&&e.push(l)}return console.log(e.length),console.timeEnd("subsets"),e},q=(t,e,o="")=>{const n=new Blob([t],{type:`application/${e}`});if(o=`${o}.${e}`,window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(n,o);else{const l=document.createElement("a"),r=document.querySelector("body");l.href=window.URL.createObjectURL(n),l.download=o,l.style.display="none",r.appendChild(l),l.click(),r.removeChild(l),window.URL.revokeObjectURL(l.href)}},L=({array:t=[],map:e={},key:o="id",value:n="item"})=>(t.forEach(l=>{const r=o?l[o]:l,c=n==="item"?l:l[n];e[r]=c}),e),ge=t=>typeof t=="string",be=t=>Object.prototype.toString.call(t)==="[object Object]",Ce=t=>Object.prototype.toString.call(t)==="[object Array]",W=t=>t==null||ge(t)&&t===""||Ce(t)&&t.length===0||be(t)&&Object.keys(t).length===0,Oe=t=>new Promise(e=>{const o=new FileReader;o.readAsText(t),o.onload=n=>{const l=JSON.parse(n.target.result);e(l)}});class z{constructor(e={}){var o;Object.assign(this,e),this.map=(o=this.map)!=null?o:{},this.options=this.getOptions()}getOptions(){const e=[];if(Object.keys(this.map).length)for(let o in this.map){/^[0-9]*$/.test(o)&&(o=+o);let n={label:this.map[o],value:o};e.push(n)}return e}}const ve=$("cart",{state:()=>({productList:[],productSelectionList:[],brandList:[],categoryCouponList:[{id:0,couponName:"\u7F8E\u5986\u60CA\u559C\u5238",couponType:"makeup",threshold:1200,off:110},{id:1,couponName:"\u7CBE\u81F4\u751F\u6D3B\u5238",couponType:"life",threshold:200,off:15}],moneyOffList:[{id:0,label:"300-50",threshold:300,off:50}],productNextId:0,voncherOptions:[{label:"1000-50",value:1e3},{label:"3800-300",value:3800},{label:"6800-300",value:6800}],orderList:[]}),getters:{brandMapping:t=>new z({map:L({array:t.brandList,key:"id",value:"brandName"})}),categoryCouponMapping:t=>new z({map:L({array:t.categoryCouponList,key:"couponType",value:"couponName"}),config:L({array:t.categoryCouponList,key:"couponType",value:"item"})}),moneyOffMapping:t=>new z({map:L({array:t.moneyOffList,key:"id",value:"label"}),config:L({array:t.moneyOffList,key:"id",value:"item"})}),productListIndexs:t=>{const e={};return t.productList.forEach((o,n)=>{e[o.id]=n}),e}},actions:{addOrder(t){this.orderList.push({...t,id:K()})},exportOrderList(){q(JSON.stringify(this.orderList,null,2),"json","orderList")},updateOrderList(t){this.orderList=t},updateProductSelectionList(t){this.productSelectionList=t},addProduct(t){const e={...t,id:this.productNextId},{productName:o}=e;this.productList.find(l=>l.productName===o)?j.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):(this.productList.push(e),this.productNextId=this.productNextId+1)},updateProduct(t){const e=this.productListIndexs[t.id];this.productList.splice(e,1,t)},deleteProduct(t){const e=this.productListIndexs[t.id];this.productList.splice(e,1)},saveProductList(){q(JSON.stringify(this.productList,null,2),"json","shoppingCart")},importProductList(t){this.productList=t,this.productNextId=U.exports.last(t.sort((e,o)=>e.id-o.id)).id+1},addBrand(t){const e={...t,id:K()},{brandName:o}=e;this.brandList.find(l=>l.brandName===o)?j.error("\u91CD\u590D\u6DFB\u52A0\uFF01"):this.brandList.push(e)},updateBrand(t,e){this.brandList.splice(e,1,t)},deleteBrand(t){this.brandList.splice(t,1)},saveBrandList(){q(JSON.stringify(this.brandList,null,2),"json","brandList")},importBrandList(t){this.brandList=t}},persist:!0});function M(){return{cart:ve()}}const ke={brandName:"",remark:""},we={brandName:[{required:!0,message:"\u8BF7\u8F93\u5165\u54C1\u724C\u540D\u79F0",trigger:"blur"}]},Me={productName:"",brandId:null,unitPrice:0,quantity:1,price:0,taoCoin:0,categoryCouponType:null,moneyOffId:0,productCoupon:0,cutPrice:0,deposit:0,remark:""},Le={productName:[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",trigger:"blur"}],brandId:[{required:!0,message:"\u8BF7\u9009\u62E9\u54C1\u724C",trigger:"change"}],unitPrice:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],quantity:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EF7\u683C"},{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],productCoupon:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],taoCoin:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],cutPrice:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}],deposit:[{type:"number",message:"\u8BF7\u8F93\u5165\u6570\u5B57"}]},Ve={data(){return{dialogVisible:!1,formModel:{},rules:Le}},setup(){const{cart:t}=M(),e=t.categoryCouponMapping.options,o=t.moneyOffMapping.options;return{cart:t,categoryCouponOptions:e,moneyOffOptions:o}},methods:{initDialog({row:t,index:e}={}){this.dialogVisible=!0,this.isAdd=!t,this.formModel=U.exports.cloneDeep(t||Me),this.index=e},closeDialog(){this.dialogVisible=!1},async handleConfirm(){await this.$refs.form.validate((t,e)=>{if(t){const{unitPrice:o,quantity:n}=this.formModel;Object.assign(this.formModel,{price:o*1e4*n/1e4}),this.isAdd?this.cart.addProduct(this.formModel):this.cart.updateProduct(this.formModel),this.closeDialog()}else console.log("error submit!",e)})}}},xe=C("span",{class:"ml10"},"%",-1),Se={class:"dialog-footer"};function Te(t,e,o,n,l,r){const c=p("el-input"),u=p("el-form-item"),s=p("el-option"),f=p("el-select"),m=p("el-input-number"),_=p("el-form"),g=p("el-button"),O=p("el-dialog");return y(),k(O,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[11]||(e[11]=d=>l.dialogVisible=d),title:"\u65B0\u589E",width:"30%","destroy-on-close":""},{footer:i(()=>[C("span",Se,[a(g,{onClick:r.closeDialog},{default:i(()=>[h("\u53D6\u6D88")]),_:1},8,["onClick"]),a(g,{type:"primary",onClick:r.handleConfirm},{default:i(()=>[h(" \u786E\u5B9A ")]),_:1},8,["onClick"])])]),default:i(()=>[a(_,{ref:"form","label-width":"100px",model:l.formModel,rules:l.rules},{default:i(()=>[a(u,{label:"\u5546\u54C1\u540D\u79F0",prop:"productName"},{default:i(()=>[a(c,{modelValue:l.formModel.productName,"onUpdate:modelValue":e[0]||(e[0]=d=>l.formModel.productName=d)},null,8,["modelValue"])]),_:1}),a(u,{label:"\u54C1\u724C",prop:"brandId"},{default:i(()=>[a(f,{modelValue:l.formModel.brandId,"onUpdate:modelValue":e[1]||(e[1]=d=>l.formModel.brandId=d),placeholder:"\u8BF7\u9009\u62E9\u54C1\u724C"},{default:i(()=>[(y(!0),v(V,null,T(n.cart.brandMapping.options,d=>(y(),k(s,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"\u5355\u4EF7",prop:"unitPrice"},{default:i(()=>[a(m,{modelValue:l.formModel.unitPrice,"onUpdate:modelValue":e[2]||(e[2]=d=>l.formModel.unitPrice=d),step:.01,controls:!1},null,8,["modelValue","step"])]),_:1}),a(u,{label:"\u6570\u91CF",prop:"quantity"},{default:i(()=>[a(m,{modelValue:l.formModel.quantity,"onUpdate:modelValue":e[3]||(e[3]=d=>l.formModel.quantity=d),min:1,controls:!1},null,8,["modelValue"])]),_:1}),a(u,{label:"\u6DD8\u91D1\u5E01\u6BD4\u4F8B",prop:"taoCoin"},{default:i(()=>[a(m,{modelValue:l.formModel.taoCoin,"onUpdate:modelValue":e[4]||(e[4]=d=>l.formModel.taoCoin=d),min:0,max:10,controls:!1},null,8,["modelValue"]),xe]),_:1}),a(u,{label:"\u54C1\u7C7B\u5238\u7C7B\u578B",prop:"categoryCouponType"},{default:i(()=>[a(f,{modelValue:l.formModel.categoryCouponType,"onUpdate:modelValue":e[5]||(e[5]=d=>l.formModel.categoryCouponType=d),placeholder:"\u8BF7\u9009\u62E9\u54C1\u7C7B\u5238\u7C7B\u578B"},{default:i(()=>[(y(!0),v(V,null,T(n.categoryCouponOptions,d=>(y(),k(s,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"\u6EE1\u51CF\u7C7B\u578B",prop:"moneyOffId"},{default:i(()=>[a(f,{modelValue:l.formModel.moneyOffId,"onUpdate:modelValue":e[6]||(e[6]=d=>l.formModel.moneyOffId=d),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6EE1\u51CF\u7C7B\u578B"},{default:i(()=>[(y(!0),v(V,null,T(n.moneyOffOptions,d=>(y(),k(s,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"\u5546\u54C1\u5238\u91D1\u989D",prop:"productCoupon"},{default:i(()=>[a(c,{modelValue:l.formModel.productCoupon,"onUpdate:modelValue":e[7]||(e[7]=d=>l.formModel.productCoupon=d),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(u,{label:"\u62CD\u4E0B\u7ACB\u51CF\u91D1\u989D",prop:"cutPrice"},{default:i(()=>[a(c,{modelValue:l.formModel.cutPrice,"onUpdate:modelValue":e[8]||(e[8]=d=>l.formModel.cutPrice=d),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(u,{label:"\u5B9A\u91D1",prop:"deposit"},{default:i(()=>[a(c,{modelValue:l.formModel.deposit,"onUpdate:modelValue":e[9]||(e[9]=d=>l.formModel.deposit=d),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(u,{label:"\u5907\u6CE8",prop:"remark"},{default:i(()=>[a(c,{modelValue:l.formModel.remark,"onUpdate:modelValue":e[10]||(e[10]=d=>l.formModel.remark=d),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}const Pe=w(Ve,[["render",Te]]);class S{constructor({productList:e=[],calcCon:o={},moneyOffConfig:n,categoryCouponConfig:l}){F(this,"getOrders",(e=[])=>{const{threshold:o,off:n}=this.moneyOffSlnConfig,l=L({array:this.productList,key:"id",value:"item"});return new Promise(r=>{const c=[];for(let u=0;u<e.length;u++){const s=e[u],f=s.map(X=>l[X]),m=this.getStatictics(f),{moneyOffPriceTotal:_,categoryCouponCalc:g,depositTotal:O}=m,d=this.getCategoryCouponSln(g),b=Object.assign(s,{order:f,...m,moneyOffTotal:Math.floor(_/o)*n,moneyOffDiff:Math.round(_%o*1e4)/1e4,...d}),x=this.getBalance(b);Object.assign(b,{balance:x,cutDeposit:x-O}),b.moneyOffDiff<=this.calcCon.moneyOff.precision&&c.push(b)}r(c)})});Object.assign(this,{productList:e,calcCon:o,categoryCouponConfig:l}),this.moneyOffSlnConfig=n[o.moneyOff.id],this.productMap=L({array:this.productList,key:"id",value:"item"})}async calc(){console.time("calc");const e=this.getSubsets();console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----");const o=await this.getResult(e);return console.log("----\u7ED3\u679C\u8BA1\u7B97\u5B8C\u6210-----"),console.timeEnd("calc"),Promise.resolve(o)}async total(){const e=this.getOrder(this.productList);return console.log(e),e}getSubsets(){const e=[],o=this.productList.length;for(let n=0;n<1<<o;++n){const l=[];for(let r=0;r<o;++r)n&1<<r&&l.push(this.productList[r]);if(l.length){const r=this.getOrder(l);r&&e.push(r)}}return e}getOrder(e){const{threshold:o,off:n}=this.moneyOffSlnConfig,l=this.getStatictics(e),{moneyOffPriceTotal:r,categoryCouponCalc:c,depositTotal:u}=l,s=this.getCategoryCouponSln(c),f={order:e,...l,moneyOffTotal:Math.floor(r/o)*n,moneyOffDiff:Math.round(r%o),...s},m=this.getBalance(f);return Object.assign(f,{balance:m,cutDeposit:m-u}),f}static moneyOffCalc({price:e,moneyOffId:o},n){let l=0;if(o!==""){const{threshold:r,off:c}=n[o]||{};l=Math.round(Math.floor(e/r)*c*1e4)/1e4}return l}static taoCoinCalc({price:e,taoCoin:o}){return o?Math.round(e*o/100*1e4)/1e4:0}getStatictics(e){return e.reduce((o,n)=>{const{moneyOffId:l,price:r,categoryCouponType:c,deposit:u,cutPrice:s,productCoupon:f,taoCoin:m}=n;return o.total=o.total+r,o.depositTotal=o.depositTotal+u,o.cutPriceTotal=o.cutPriceTotal+s,o.productCouponTotal=o.productCouponTotal+f,l===this.moneyOffSlnConfig.id&&(o.moneyOffPriceTotal=o.moneyOffPriceTotal+r),c&&(o.categoryCouponCalc[c]=o.categoryCouponCalc[c]+r),m&&(o.taoCoinTotal=o.taoCoinTotal+S.taoCoinCalc(n)),o},{total:0,moneyOffPriceTotal:0,depositTotal:0,cutPriceTotal:0,productCouponTotal:0,taoCoinTotal:0,categoryCouponCalc:{life:0,makeup:0}})}getCategoryCouponSln(e){const o={categoryCoupon:[],categoryCouponTotal:0};return Object.entries(e).forEach(([n,l])=>{const{threshold:r}=this.categoryCouponConfig[n];l>=r&&(o.categoryCoupon.push(n),o.categoryCouponTotal=o.categoryCouponTotal+this.categoryCouponConfig[n].off)}),o}getBalance(e){const{total:o,moneyOffTotal:n,categoryCouponTotal:l,productCouponTotal:r,cutPriceTotal:c,taoCoinTotal:u}=e,s=o-n-l-r-u-c;return Math.round(s*1e4)/1e4}async getResult(e){const o=[];for(let n=0;n<e.length;n++){const l=e[n];l.products=l.order.map(f=>f.productName).join("|");const{moneyOff:r,balance:c,categoryCoupon:u}=this.calcCon;let s=null;if(l.moneyOffDiff<=r.precision&&(s=l),s&&u.type.length&&(s=null,u.type.length>1?u.type.length===l.categoryCoupon.length&&(s=l):u.type.forEach(f=>{l.categoryCoupon.includes(f)&&(s=l)})),s&&!u.calc&&l.categoryCoupon.length&&(s=null),s&&c.calc){s=null;const{threshold:f,precision:m}=c;l.balance>=f&&l.balance-f<=m&&(l.balanceDiff=l.balance-f,s=l)}s&&o.push(s)}return this.calcCon.balance.calc?o.sort((n,l)=>n.balanceDiff-l.balanceDiff):o.sort((n,l)=>n.moneyOffDiff-l.moneyOffDiff),o}async _getSubsets(){const e=this.getIdSubsets();console.log("----\u5546\u54C1ID\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210------");const o=await this.getOrders(e);return console.log("----\u8BA2\u5355\u7EC4\u5408\u8BA1\u7B97\u5B8C\u6210-----"),o}getIdSubsets(){return he(this.productList.map(e=>e.id))}}const De={components:{AddOrUpdate:Pe},data(){return{columns:[]}},setup(){const{cart:t}=M(),{productList:e,productSelectionList:o,brandList:n}=N(t),l=B(()=>t.categoryCouponMapping),r=B(()=>t.moneyOffMapping),c=async()=>{const f=await new S({productList:o.value.length?o.value:e.value,calcCon:{moneyOff:{id:0}},moneyOffConfig:r.value.config,categoryCouponConfig:l.value.config}).total(),{balance:m,depositTotal:_,cutDeposit:g}=f;de.alert(`\u5546\u54C1\u603B\u4EF7\uFF1A${f.total}  \u5B9E\u4ED8\uFF1A${m} \u5DF2\u4ED8\u5B9A\u91D1\uFF1A${_}  \u5C3E\u6B3E\u5B9E\u4ED8\uFF1A${g}`,"\u9009\u4E2D\u603B\u8BA1")};return{filterTableData:B(()=>U.exports.orderBy(e.value.map(s=>{const{price:f,moneyOffId:m,productCoupon:_,cutPrice:g}=s,O=f-_-g-S.moneyOffCalc(s,r.value.config)-S.taoCoinCalc(s);return Object.assign(U.exports.cloneDeep(s),{balance:O,moneyOffIdOrder:W(m)?-1:m,moneyOffDesc:r.value.map[m],categoryCouponDesc:l.value.map[s.categoryCouponType],taoCoinPer:s.taoCoin?`${s.taoCoin}%`:"-"})}),["categoryCouponType","moneyOffIdOrder","balance"],["asc","desc","desc"])),cart:t,brandList:n,categoryCouponMapping:l,moneyOffMapping:r,handleCalcTotal:c,isEmpty:W}},created(){this.generateColumns()},methods:{handleAddOrUpdate(t){this.$refs.add.initDialog(t)},handleBeforeUpload(t){const e=new FileReader;e.readAsText(t),e.onload=o=>{const n=JSON.parse(o.target.result);this.cart.importProductList(n)}},generateColumns(){const t=[{key:"id",title:"ID",width:50},{key:"productName",title:"\u5546\u54C1\u540D",width:200},{key:"price",title:"\u6D3B\u52A8\u4EF7",width:100,sortable:!0},{key:"balance",title:"\u5B9E\u4ED8",width:100},{key:"categoryCouponType",title:"\u54C1\u7C7B\u5238",width:100},{key:"moneyOffId",title:"\u6EE1\u51CF\u6D3B\u52A8",width:100},{key:"productCoupon",title:"\u5546\u54C1\u5238",width:100},{key:"cutPrice",title:"\u62CD\u4E0B\u7ACB\u51CF",width:100},{key:"deposit",title:"\u5B9A\u91D1",width:100},{key:"operations",type:"oper",title:"\u64CD\u4F5C",width:100}];this.columns=t.map(e=>{const{key:o,type:n}=e;return Object.assign(e,{props:o,dataKey:n?void 0:o})})},handleSelectionChange(t){this.cart.updateProductSelectionList(t)}}},Ue={class:"cart__wrapper"},Ne={style:{display:"flex",gap:"10px"}},Ie={class:"cart-table__wrapper"};function Be(t,e,o,n,l,r){const c=p("el-button"),u=p("el-upload"),s=p("el-table-column"),f=p("el-tag"),m=p("el-table"),_=p("el-auto-resizer"),g=p("add-or-update");return y(),v("div",Ue,[C("div",Ne,[a(c,{type:"primary",disabled:!n.brandList.length,onClick:r.handleAddOrUpdate},{default:i(()=>[h("\u65B0\u589E\u5546\u54C1")]),_:1},8,["disabled","onClick"]),a(c,{type:"primary",onClick:n.cart.saveProductList},{default:i(()=>[h("\u5BFC\u51FA")]),_:1},8,["onClick"]),a(u,{accept:".json","show-file-list":!1,action:"#",beforeUpload:r.handleBeforeUpload},{trigger:i(()=>[a(c,null,{default:i(()=>[h(" \u5BFC\u5165 ")]),_:1})]),_:1},8,["accept","beforeUpload"]),a(c,{class:"ml10",onClick:n.handleCalcTotal},{default:i(()=>[h("\u603B\u8BA1")]),_:1},8,["onClick"])]),C("div",Ie,[a(_,null,{default:i(({height:O,width:d})=>[a(m,{ref:"table",data:n.filterTableData,width:d,height:O,onSelectionChange:r.handleSelectionChange},{default:i(()=>[a(s,{type:"selection",width:"55"}),a(s,{prop:"id",label:"ID",width:"50"}),a(s,{prop:"productName",label:"\u5546\u54C1\u540D",width:"200"}),a(s,{prop:"categoryCouponType",label:"\u54C1\u7C7B\u5238",width:"120"},{default:i(({row:b})=>[b.categoryCouponDesc?(y(),k(f,{key:0,effect:"plain"},{default:i(()=>[h(P(b.categoryCouponDesc),1)]),_:2},1024)):J("",!0)]),_:1}),a(s,{prop:"moneyOffId",label:"\u6EE1\u51CF\u6D3B\u52A8",width:"100"},{default:i(({row:b})=>[b.moneyOffDesc?(y(),k(f,{key:0,effect:"dark"},{default:i(()=>[h(P(b.moneyOffDesc),1)]),_:2},1024)):J("",!0)]),_:1}),a(s,{prop:"price",label:"\u6D3B\u52A8\u4EF7",width:"100"}),a(s,{prop:"productCoupon",label:"\u5546\u54C1\u5238",width:"100"}),a(s,{prop:"cutPrice",label:"\u62CD\u4E0B\u7ACB\u51CF",width:"100"}),a(s,{prop:"deposit",label:"\u5B9A\u91D1",width:"100"}),a(s,{prop:"taoCoinPer",label:"\u6DD8\u91D1\u5E01",width:"100"}),a(s,{prop:"balance",label:"\u5230\u624B\u4EF7",width:"100"}),a(s,{prop:"remark",label:"\u5907\u6CE8"}),a(s,{fixed:"right",label:"\u64CD\u4F5C",width:"120"},{default:i(({row:b})=>[a(c,{link:"",type:"primary",size:"small",onClick:D(x=>r.handleAddOrUpdate({row:b}),["prevent"])},{default:i(()=>[h(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(c,{link:"",type:"primary",size:"small",onClick:D(x=>n.cart.deleteProduct(b),["prevent"])},{default:i(()=>[h(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data","width","height","onSelectionChange"])]),_:1})]),a(g,{ref:"add"},null,512)])}const je=w(De,[["render",Be],["__scopeId","data-v-2c7a9ad8"]]),Ae={data(){return{dialogVisible:!1,formModel:{},rules:we}},setup(){const{cart:t}=M();return{cart:t}},methods:{initDialog({row:t,index:e}={}){this.dialogVisible=!0,this.isAdd=!t,this.formModel=U.exports.cloneDeep(t||ke),this.index=e},closeDialog(){this.dialogVisible=!1},async handleConfirm(){await this.$refs.form.validate((t,e)=>{t?(this.isAdd?this.cart.addBrand(this.formModel):this.cart.updateBrand(this.formModel,this.index),this.closeDialog()):console.log("error submit!",e)})}}},Re={class:"dialog-footer"};function Ee(t,e,o,n,l,r){const c=p("el-input"),u=p("el-form-item"),s=p("el-form"),f=p("el-button"),m=p("el-dialog");return y(),k(m,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[2]||(e[2]=_=>l.dialogVisible=_),title:"\u65B0\u589E",width:"30%","destroy-on-close":"",center:""},{footer:i(()=>[C("span",Re,[a(f,{onClick:r.closeDialog},{default:i(()=>[h("\u53D6\u6D88")]),_:1},8,["onClick"]),a(f,{type:"primary",onClick:r.handleConfirm},{default:i(()=>[h(" \u786E\u5B9A ")]),_:1},8,["onClick"])])]),default:i(()=>[a(s,{ref:"form","label-width":"100px",model:l.formModel,rules:l.rules},{default:i(()=>[a(u,{label:"\u54C1\u724C\u540D\u79F0",prop:"brandName"},{default:i(()=>[a(c,{modelValue:l.formModel.brandName,"onUpdate:modelValue":e[0]||(e[0]=_=>l.formModel.brandName=_)},null,8,["modelValue"])]),_:1}),a(u,{label:"\u5907\u6CE8",prop:"remark"},{default:i(()=>[a(c,{modelValue:l.formModel.remark,"onUpdate:modelValue":e[1]||(e[1]=_=>l.formModel.remark=_),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}const qe=w(Ae,[["render",Ee]]);const ze={components:{AddBrand:qe},data(){return{columns:[]}},setup(){const{cart:t}=M(),{brandList:e}=N(t);return{cart:t,brandList:e}},methods:{handleAddOrUpdate(t){this.$refs.add.initDialog(t)},handleBeforeUpload(t){const e=new FileReader;e.readAsText(t),e.onload=o=>{const n=JSON.parse(o.target.result);this.cart.importBrandList(n)}}}},Fe={class:"cart__wrapper"},Je={style:{display:"flex"}},Ke={class:"cart-table__wrapper"};function We(t,e,o,n,l,r){const c=p("el-button"),u=p("el-upload"),s=p("el-table-column"),f=p("el-table"),m=p("el-auto-resizer"),_=p("add-brand");return y(),v("div",Fe,[C("div",Je,[a(c,{type:"primary",onClick:r.handleAddOrUpdate},{default:i(()=>[h("\u65B0\u589E\u54C1\u724C")]),_:1},8,["onClick"]),a(c,{type:"primary",onClick:n.cart.saveBrandList},{default:i(()=>[h("\u5BFC\u51FA")]),_:1},8,["onClick"]),a(u,{accept:".json","show-file-list":!1,action:"#",beforeUpload:r.handleBeforeUpload},{trigger:i(()=>[a(c,null,{default:i(()=>[h(" \u5BFC\u5165 ")]),_:1})]),_:1},8,["accept","beforeUpload"])]),C("div",Ke,[a(m,null,{default:i(({height:g,width:O})=>[a(f,{data:n.brandList,width:O,height:g},{default:i(()=>[a(s,{prop:"id",label:"ID",width:"120"}),a(s,{prop:"brandName",label:"\u54C1\u724C\u540D",width:"150"}),a(s,{prop:"remark",label:"\u5907\u6CE8"}),a(s,{label:"\u64CD\u4F5C",width:"120"},{default:i(({row:d,$index:b})=>[a(c,{link:"",type:"primary",size:"small",onClick:D(x=>r.handleAddOrUpdate({row:d,index:b}),["prevent"])},{default:i(()=>[h(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(c,{link:"",type:"primary",size:"small",onClick:D(x=>n.cart.deleteBrand(b),["prevent"])},{default:i(()=>[h(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data","width","height"])]),_:1})]),a(_,{ref:"add"},null,512)])}const He=w(ze,[["render",We],["__scopeId","data-v-d1e7202b"]]),Qe={props:{dataModel:{type:Object,required:!0},config:{type:Object,required:!0}},data(){return{}},methods:{}};function Ge(t,e,o,n,l,r){const c=p("el-option"),u=p("el-select");return y(),k(u,{modelValue:o.dataModel[o.config.key],"onUpdate:modelValue":e[0]||(e[0]=s=>o.dataModel[o.config.key]=s),clearable:o.config.clearable,multiple:o.config.multiple,disabled:o.config.disabled},{default:i(()=>[(y(!0),v(V,null,T(o.config.options,s=>(y(),k(c,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","clearable","multiple","disabled"])}const Xe=w(Qe,[["render",Ge]]);const Ye={components:{SelectItem:Xe},data(){return{}},props:{total:{type:Number,default:0},result:{type:Object}},setup(t,e){const{proxy:o}=ee(),n=R({calc:!0,id:0,precision:0}),l=R({calc:!0,type:["makeup","life"]}),r=R({calc:!1,threshold:1e3,precision:50}),{cart:c}=M(),{productList:u,productSelectionList:s}=N(c),f=B(()=>s.value.length||u.value.length);return{cart:c,filterProdLength:f,handleCalcMoneyOff:()=>{if(f.value>24){o.$msg.error("\u9009\u62E9\u6570\u636E\u8FC7\u591A\uFF01");return}e.emit("calc",{categoryCoupon:l,moneyOff:n,balance:r})},categoryCoupon:l,moneyOff:n,balance:r}}},Ze=t=>(H("data-v-35797b7a"),t=t(),Q(),t),$e={class:"calc-btn__wrapper"},et=Ze(()=>C("div",{class:"ml10"},"\u7B5B\u9009\u7CBE\u5EA6\uFF1A",-1)),tt={class:"ml10"};function ot(t,e,o,n,l,r){const c=p("el-input"),u=p("el-form-item"),s=p("el-checkbox"),f=p("select-item"),m=p("el-option"),_=p("el-select"),g=p("el-form"),O=p("el-button");return y(),v("div",$e,[a(g,{ref:"form","label-width":"100px",inline:!0,"label-suffix":":"},{default:i(()=>[a(u,{label:"\u6EE1\u51CF\u8BA1\u7B97"},{default:i(()=>[et,a(c,{modelValue:n.moneyOff.precision,"onUpdate:modelValue":e[0]||(e[0]=d=>n.moneyOff.precision=d),modelModifiers:{number:!0},disabled:!n.moneyOff.calc,style:{width:"100px"}},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"\u54C1\u7C7B\u5238"},{default:i(()=>[a(s,{modelValue:n.categoryCoupon.calc,"onUpdate:modelValue":e[1]||(e[1]=d=>n.categoryCoupon.calc=d)},null,8,["modelValue"]),a(f,{class:"ml10",style:{width:"250px"},dataModel:n.categoryCoupon,config:{key:"type",clearable:!0,multiple:!0,disabled:!n.categoryCoupon.calc,options:n.cart.categoryCouponMapping.options}},null,8,["dataModel","config"])]),_:1}),a(u,{label:"\u4F7F\u7528\u6D88\u8D39\u5238"},{default:i(()=>[a(s,{modelValue:n.balance.calc,"onUpdate:modelValue":e[2]||(e[2]=d=>n.balance.calc=d)},null,8,["modelValue"]),a(_,{modelValue:n.balance.threshold,"onUpdate:modelValue":e[3]||(e[3]=d=>n.balance.threshold=d),class:"ml10",clearable:"",style:{width:"120px"},disabled:!n.balance.calc},{default:i(()=>[(y(!0),v(V,null,T(n.cart.voncherOptions,d=>(y(),k(m,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),h(" \u7B5B\u9009\u7CBE\u5EA6\uFF1A "),a(c,{modelValue:n.balance.precision,"onUpdate:modelValue":e[4]||(e[4]=d=>n.balance.precision=d),modelModifiers:{number:!0},disabled:!n.balance.calc,style:{width:"100px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1},512),C("div",null,"\u9009\u4E2D"+P(n.filterProdLength)+"\u4E2A\u5546\u54C1",1),a(O,{class:"ml10",onClick:n.handleCalcMoneyOff},{default:i(()=>[h("\u67E5\u8BE2")]),_:1},8,["onClick"]),C("div",tt,"\u7ED3\u679C\u5171"+P(o.total)+"\u6761",1)])}const lt=w(Ye,[["render",ot],["__scopeId","data-v-35797b7a"]]);const nt={components:{FilterCondition:lt},data(){return{columns:[],orders:[]}},setup(){const{cart:t}=M(),{productList:e,productSelectionList:o}=N(t),n=E(!1),l=E(""),r=E([]),c=()=>{n.value=!0,r.value=[],l.value="\u8BA1\u7B97\u4E2D"},u=()=>{n.value=!1,l.value="",r.value.length===0&&j.info("\u65E0\u7ED3\u679C\uFF0C\u8BF7\u4FEE\u6539\u7B5B\u9009\u6761\u4EF6!")},s=m=>new S({productList:I(o.value.length?o.value:e.value),calcCon:I(m),moneyOffConfig:I(t.moneyOffMapping.config),categoryCouponConfig:I(t.categoryCouponMapping.config)});return{cart:t,productList:e,productSelectionList:o,loading:n,loadingMsg:l,dataSource:r,handleCalcMoneyOff:m=>{c(),setTimeout(async()=>{const _=s(m);r.value=await _.calc(),u()},50)}}},methods:{handleMarkOrder({row:t}){this.cart.addOrder(t)},generateColumns(){const t=[{key:"products",title:"\u8BA2\u5355\u5546\u54C1",width:800},{key:"total",title:"\u603B\u8BA1",width:100},{key:"moneyOffPriceTotal",title:"\u6EE1\u51CF\u603B\u8BA1",width:100},{key:"moneyOffDiff",title:"\u6EE1\u51CF\u5DEE\u503C",width:100},{key:"balance",title:"\u5B9E\u4ED8",width:100},{key:"balanceDiff",title:"\u6D88\u8D39\u5238\u95E8\u69DB\u5DEE\u503C",width:150},{key:"categoryCoupon",title:"\u4F7F\u7528\u54C1\u7C7B\u5238",width:150},{key:"operations",width:120,type:"oper",title:"\u64CD\u4F5C"}];this.columns=t.map(e=>{const{key:o}=e;return Object.assign(e,{props:o,dataKey:o})})}},created(){this.generateColumns()}},at=["element-loading-text"],rt={class:"sln__wrapper"};function st(t,e,o,n,l,r){const c=p("filter-condition"),u=p("el-button"),s=p("el-table-v2"),f=p("el-auto-resizer"),m=te("loading");return oe((y(),v("div",{class:"result__wrapper","element-loading-text":n.loadingMsg},[a(c,{total:n.dataSource.length,onCalc:n.handleCalcMoneyOff},null,8,["total","onCalc"]),C("div",rt,[a(f,null,{default:i(({height:_,width:g})=>[a(s,{columns:l.columns,data:n.dataSource,width:g,height:_},{cell:i(({column:O,rowData:d})=>[O.type==="oper"?(y(),k(u,{key:0,link:"",type:"primary",size:"small",onClick:D(b=>r.handleMarkOrder({row:d}),["prevent"])},{default:i(()=>[h(" \u6807\u8BB0 ")]),_:2},1032,["onClick"])):(y(),v(V,{key:1},[h(P(d[O.dataKey]),1)],64))]),_:2},1032,["columns","data","width","height"])]),_:1})])],8,at)),[[m,n.loading]])}const it=w(nt,[["render",st],["__scopeId","data-v-20a7ebe0"]]),ct={data(){return{}},setup(){const{cart:t}=M(),{orderList:e}=N(t);return{orderList:e,cart:t}},methods:{handleBeforeUpload(t){Oe(t).then(e=>{this.cart.updateOrderList(e)})},generateColumns(){const t=[{key:"products",title:"\u8BA2\u5355\u5546\u54C1",width:800},{key:"total",title:"\u603B\u8BA1",width:100},{key:"moneyOffPriceTotal",title:"\u6EE1\u51CF\u603B\u8BA1",width:100},{key:"moneyOffDiff",title:"\u6EE1\u51CF\u5DEE\u503C",width:100},{key:"balance",title:"\u5B9E\u4ED8",width:100},{key:"balanceDiff",title:"\u6D88\u8D39\u5238\u95E8\u69DB\u5DEE\u503C",width:150},{key:"categoryCoupon",title:"\u4F7F\u7528\u54C1\u7C7B\u5238",width:150}];this.columns=t.map(e=>{const{key:o}=e;return Object.assign(e,{props:o,dataKey:o})})}},created(){this.generateColumns()}},dt={class:"cart__wrapper"},ut={style:{display:"flex",gap:"10px"}},pt={class:"cart-table__wrapper"};function ft(t,e,o,n,l,r){const c=p("el-button"),u=p("el-upload"),s=p("el-table-v2"),f=p("el-auto-resizer");return y(),v("div",dt,[C("div",ut,[a(c,{type:"primary",onClick:n.cart.exportOrderList},{default:i(()=>[h("\u5BFC\u51FA")]),_:1},8,["onClick"]),a(u,{accept:".json","show-file-list":!1,action:"#",beforeUpload:r.handleBeforeUpload},{trigger:i(()=>[a(c,null,{default:i(()=>[h(" \u5BFC\u5165 ")]),_:1})]),_:1},8,["accept","beforeUpload"])]),C("div",pt,[a(f,null,{default:i(({height:m,width:_})=>[a(s,{columns:t.columns,data:n.orderList,width:_,height:m},null,8,["columns","data","width","height"])]),_:1})])])}const mt=w(ct,[["render",ft]]);const _t={data(){return{activeName:"cart"}},setup(){const{cart:t}=M();le(()=>{t.updateProductSelectionList([])})},components:{ShoppingCart:je,MoneyOffResult:it,BrandList:He,OrderList:mt},methods:{}},yt={class:"page_wrapper"},ht={class:"main__wrapper"};function gt(t,e,o,n,l,r){const c=p("shopping-cart"),u=p("el-tab-pane"),s=p("brand-list"),f=p("order-list"),m=p("el-tabs"),_=p("money-off-result");return y(),v("div",yt,[C("div",ht,[a(m,{modelValue:l.activeName,"onUpdate:modelValue":e[0]||(e[0]=g=>l.activeName=g)},{default:i(()=>[a(u,{label:"\u8D2D\u7269\u8F66",name:"cart"},{default:i(()=>[a(c)]),_:1}),a(u,{label:"\u54C1\u724C",name:"brand"},{default:i(()=>[a(s)]),_:1}),a(u,{label:"\u8BA2\u5355\u7EC4\u5408",name:"order"},{default:i(()=>[a(f)]),_:1})]),_:1},8,["modelValue"])]),a(_,{class:"money-off-wrapper"})])}const bt=w(_t,[["render",gt]]),Ct=ne({history:ae("/moneyoffcalc/"),routes:[{path:"/",name:"home",component:bt}]});const A=re(ye),G=se();G.use(ie);A.use(G);A.use(Ct).use(ue);A.config.globalProperties.$msg=j;A.mount("#app");
